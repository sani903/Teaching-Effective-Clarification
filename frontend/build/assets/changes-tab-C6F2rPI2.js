import{r as c,R as y,p as d}from"./chunk-NISHYRIK-CgksP-ke.js";import{G as ne}from"./index-CQq-b-9n.js";import{r as ae,c as re}from"./utils-C5iw9p3M.js";import{a as ye}from"./use-config-BtaDlBUv.js";import{G as we}from"./git-service.api-C9ZaYUVf.js";import{a as se}from"./open-hands-axios-DsgPCc-0.js";import{a as De}from"./feature-flags-1f3MRGYs.js";import{b as Ee,u as je,R as Ne}from"./parse-pr-url-CCSuKL2A.js";import{r as ce}from"./retrieve-axios-error-message-CYr77e_f.js";import{u as $e,a as _e}from"./conversation-BJC1AsS5.js";import{I as j}from"./declaration-BLNM_M5s.js";import{u as Se}from"./useTranslation-BhtO8iYN.js";import"./option-service.api-L97_35Hu.js";import"./gestures-BcGXZsOZ.js";import"./index-BBSevn_K.js";import"./module-CWLbpm_7.js";import"./index-DJ6Yt2gU.js";import"./optimistic-user-message-store-BLUkFBLR.js";import"./brand-button-BLaTuvKj.js";import"./query-client-config-D_0Qd0_c.js";import"./i18next-Lgj2Bm8L.js";import"./custom-toast-handlers-B_1yfMGT.js";import"./infiniteQueryBehavior-D4OZgA3F.js";import"./use-user-providers-CPbKIWnc.js";import"./use-settings-y2Eq7ITW.js";import"./use-is-authed-CJdzFdqm.js";import"./close-_PwA9ZeD.js";import"./index-DastLBCt.js";import"./useSingleSelectListState-D8PQAT0i.js";import"./preload-helper-BhQ1_4_d.js";import"./middleware-BNIo_uWn.js";import"./index-JS6LK1M2.js";import"./index-0urWFDHv.js";import"./base-modal-LOTJhsuL.js";import"./modal-body-DfkwqNDR.js";import"./modal-backdrop-CfHRd2ER.js";import"./tooltip-button-CGDIzzom.js";import"./typography-DvyHXuI5.js";import"./repo-forked-Bc3iCQ5X.js";import"./index-Cfwn16jo.js";import"./Trans-CSq1Url9.js";import"./settings-dropdown-input-DCArA_yj.js";import"./optional-tag-C2att6n-.js";import"./chunk-S6H5EOGR-BBckzTk7.js";import"./loading-spinner-CE6B7tvy.js";function Ue(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ue(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function le(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ue(Object(r),!0).forEach(function(n){Ue(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ue(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ve(e,t){if(e==null)return{};var r={},n=Object.keys(e),i,o;for(o=0;o<n.length;o++)i=n[o],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}function Fe(e,t){if(e==null)return{};var r=Ve(e,t),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Ge(e,t){return He(e)||Be(e,t)||qe(e,t)||We()}function He(e){if(Array.isArray(e))return e}function Be(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,i=!1,o=void 0;try{for(var a=e[Symbol.iterator](),s;!(n=(s=a.next()).done)&&(r.push(s.value),!(t&&r.length===t));n=!0);}catch(l){i=!0,o=l}finally{try{!n&&a.return!=null&&a.return()}finally{if(i)throw o}}return r}}function qe(e,t){if(e){if(typeof e=="string")return de(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return de(e,t)}}function de(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function We(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ze(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function pe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fe(Object(r),!0).forEach(function(n){ze(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fe(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ke(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(n){return t.reduceRight(function(i,o){return o(i)},n)}}function V(e){return function t(){for(var r=this,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return i.length>=e.length?e.apply(this,i):function(){for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return t.apply(r,[].concat(i,s))}}}function K(e){return{}.toString.call(e).includes("Object")}function Ze(e){return!Object.keys(e).length}function G(e){return typeof e=="function"}function Ye(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Qe(e,t){return K(t)||A("changeType"),Object.keys(t).some(function(r){return!Ye(e,r)})&&A("changeField"),t}function Je(e){G(e)||A("selectorType")}function Xe(e){G(e)||K(e)||A("handlerType"),K(e)&&Object.values(e).some(function(t){return!G(t)})&&A("handlersType")}function et(e){e||A("initialIsRequired"),K(e)||A("initialType"),Ze(e)&&A("initialContent")}function tt(e,t){throw new Error(e[t]||e.default)}var rt={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},A=V(tt)(rt),W={changes:Qe,selector:Je,handler:Xe,initial:et};function nt(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};W.initial(e),W.handler(t);var r={current:e},n=V(at)(r,t),i=V(ot)(r),o=V(W.changes)(e),a=V(it)(r);function s(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(x){return x};return W.selector(p),p(r.current)}function l(p){Ke(n,i,o,a)(p)}return[s,l]}function it(e,t){return G(t)?t(e.current):t}function ot(e,t){return e.current=pe(pe({},e.current),t),t}function at(e,t,r){return G(t)?t(e.current):Object.keys(r).forEach(function(n){var i;return(i=t[n])===null||i===void 0?void 0:i.call(t,e.current[n])}),r}var st={create:nt},ct={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs"}};function ut(e){return function t(){for(var r=this,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return i.length>=e.length?e.apply(this,i):function(){for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return t.apply(r,[].concat(i,s))}}}function lt(e){return{}.toString.call(e).includes("Object")}function dt(e){return e||he("configIsRequired"),lt(e)||he("configType"),e.urls?(ft(),{paths:{vs:e.urls.monacoBase}}):e}function ft(){console.warn(Me.deprecation)}function pt(e,t){throw new Error(e[t]||e.default)}var Me={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},he=ut(pt)(Me),ht={config:dt},gt=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return function(i){return r.reduceRight(function(o,a){return a(o)},i)}};function Oe(e,t){return Object.keys(t).forEach(function(r){t[r]instanceof Object&&e[r]&&Object.assign(t[r],Oe(e[r],t[r]))}),le(le({},e),t)}var mt={type:"cancelation",msg:"operation is manually canceled"};function X(e){var t=!1,r=new Promise(function(n,i){e.then(function(o){return t?i(mt):n(o)}),e.catch(i)});return r.cancel=function(){return t=!0},r}var vt=st.create({config:ct,isInitialized:!1,resolve:null,reject:null,monaco:null}),xe=Ge(vt,2),H=xe[0],Z=xe[1];function bt(e){var t=ht.config(e),r=t.monaco,n=Fe(t,["monaco"]);Z(function(i){return{config:Oe(i.config,n),monaco:r}})}function yt(){var e=H(function(t){var r=t.monaco,n=t.isInitialized,i=t.resolve;return{monaco:r,isInitialized:n,resolve:i}});if(!e.isInitialized){if(Z({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),X(ee);if(window.monaco&&window.monaco.editor)return Ie(window.monaco),e.resolve(window.monaco),X(ee);gt(wt,jt)(St)}return X(ee)}function wt(e){return document.body.appendChild(e)}function Et(e){var t=document.createElement("script");return e&&(t.src=e),t}function jt(e){var t=H(function(n){var i=n.config,o=n.reject;return{config:i,reject:o}}),r=Et("".concat(t.config.paths.vs,"/loader.js"));return r.onload=function(){return e()},r.onerror=t.reject,r}function St(){var e=H(function(r){var n=r.config,i=r.resolve,o=r.reject;return{config:n,resolve:i,reject:o}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(r){Ie(r),e.resolve(r)},function(r){e.reject(r)})}function Ie(e){H().monaco||Z({monaco:e})}function Mt(){return H(function(e){var t=e.monaco;return t})}var ee=new Promise(function(e,t){return Z({resolve:e,reject:t})}),Pe={config:bt,init:yt,__getMonacoInstance:Mt},Ot={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},te=Ot,xt={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},It=xt;function Pt({children:e}){return y.createElement("div",{style:It.container},e)}var Rt=Pt,Tt=Rt;function Ct({width:e,height:t,isEditorReady:r,loading:n,_ref:i,className:o,wrapperProps:a}){return y.createElement("section",{style:{...te.wrapper,width:e,height:t},...a},!r&&y.createElement(Tt,null,n),y.createElement("div",{ref:i,style:{...te.fullWidth,...!r&&te.hide},className:o}))}var At=Ct,Re=c.memo(At);function kt(e){c.useEffect(e,[])}var Te=kt;function Lt(e,t,r=!0){let n=c.useRef(!0);c.useEffect(n.current||!r?()=>{n.current=!1}:e,t)}var I=Lt;function F(){}function _(e,t,r,n){return Dt(e,n)||Nt(e,t,r,n)}function Dt(e,t){return e.editor.getModel(Ce(e,t))}function Nt(e,t,r,n){return e.editor.createModel(t,r,n?Ce(e,n):void 0)}function Ce(e,t){return e.Uri.parse(t)}function $t({original:e,modified:t,language:r,originalLanguage:n,modifiedLanguage:i,originalModelPath:o,modifiedModelPath:a,keepCurrentOriginalModel:s=!1,keepCurrentModifiedModel:l=!1,theme:p="light",loading:x="Loading...",options:u={},height:P="100%",width:k="100%",className:R,wrapperProps:L={},beforeMount:D=F,onMount:S=F}){let[w,T]=c.useState(!1),[m,g]=c.useState(!0),b=c.useRef(null),v=c.useRef(null),N=c.useRef(null),M=c.useRef(S),f=c.useRef(D),$=c.useRef(!1);Te(()=>{let h=Pe.init();return h.then(E=>(v.current=E)&&g(!1)).catch(E=>E?.type!=="cancelation"&&console.error("Monaco initialization: error:",E)),()=>b.current?U():h.cancel()}),I(()=>{if(b.current&&v.current){let h=b.current.getOriginalEditor(),E=_(v.current,e||"",n||r||"text",o||"");E!==h.getModel()&&h.setModel(E)}},[o],w),I(()=>{if(b.current&&v.current){let h=b.current.getModifiedEditor(),E=_(v.current,t||"",i||r||"text",a||"");E!==h.getModel()&&h.setModel(E)}},[a],w),I(()=>{let h=b.current.getModifiedEditor();h.getOption(v.current.editor.EditorOption.readOnly)?h.setValue(t||""):t!==h.getValue()&&(h.executeEdits("",[{range:h.getModel().getFullModelRange(),text:t||"",forceMoveMarkers:!0}]),h.pushUndoStop())},[t],w),I(()=>{b.current?.getModel()?.original.setValue(e||"")},[e],w),I(()=>{let{original:h,modified:E}=b.current.getModel();v.current.editor.setModelLanguage(h,n||r||"text"),v.current.editor.setModelLanguage(E,i||r||"text")},[r,n,i],w),I(()=>{v.current?.editor.setTheme(p)},[p],w),I(()=>{b.current?.updateOptions(u)},[u],w);let B=c.useCallback(()=>{if(!v.current)return;f.current(v.current);let h=_(v.current,e||"",n||r||"text",o||""),E=_(v.current,t||"",i||r||"text",a||"");b.current?.setModel({original:h,modified:E})},[r,t,i,e,n,o,a]),q=c.useCallback(()=>{!$.current&&N.current&&(b.current=v.current.editor.createDiffEditor(N.current,{automaticLayout:!0,...u}),B(),v.current?.editor.setTheme(p),T(!0),$.current=!0)},[u,p,B]);c.useEffect(()=>{w&&M.current(b.current,v.current)},[w]),c.useEffect(()=>{!m&&!w&&q()},[m,w,q]);function U(){let h=b.current?.getModel();s||h?.original?.dispose(),l||h?.modified?.dispose(),b.current?.dispose()}return y.createElement(Re,{width:k,height:P,isEditorReady:w,loading:x,_ref:N,className:R,wrapperProps:L})}var _t=$t,Ut=c.memo(_t);function Vt(e){let t=c.useRef();return c.useEffect(()=>{t.current=e},[e]),t.current}var Ft=Vt,z=new Map;function Gt({defaultValue:e,defaultLanguage:t,defaultPath:r,value:n,language:i,path:o,theme:a="light",line:s,loading:l="Loading...",options:p={},overrideServices:x={},saveViewState:u=!0,keepCurrentModel:P=!1,width:k="100%",height:R="100%",className:L,wrapperProps:D={},beforeMount:S=F,onMount:w=F,onChange:T,onValidate:m=F}){let[g,b]=c.useState(!1),[v,N]=c.useState(!0),M=c.useRef(null),f=c.useRef(null),$=c.useRef(null),B=c.useRef(w),q=c.useRef(S),U=c.useRef(),h=c.useRef(n),E=Ft(o),ie=c.useRef(!1),Y=c.useRef(!1);Te(()=>{let O=Pe.init();return O.then(C=>(M.current=C)&&N(!1)).catch(C=>C?.type!=="cancelation"&&console.error("Monaco initialization: error:",C)),()=>f.current?Le():O.cancel()}),I(()=>{let O=_(M.current,e||n||"",t||i||"",o||r||"");O!==f.current?.getModel()&&(u&&z.set(E,f.current?.saveViewState()),f.current?.setModel(O),u&&f.current?.restoreViewState(z.get(o)))},[o],g),I(()=>{f.current?.updateOptions(p)},[p],g),I(()=>{!f.current||n===void 0||(f.current.getOption(M.current.editor.EditorOption.readOnly)?f.current.setValue(n):n!==f.current.getValue()&&(Y.current=!0,f.current.executeEdits("",[{range:f.current.getModel().getFullModelRange(),text:n,forceMoveMarkers:!0}]),f.current.pushUndoStop(),Y.current=!1))},[n],g),I(()=>{let O=f.current?.getModel();O&&i&&M.current?.editor.setModelLanguage(O,i)},[i],g),I(()=>{s!==void 0&&f.current?.revealLine(s)},[s],g),I(()=>{M.current?.editor.setTheme(a)},[a],g);let oe=c.useCallback(()=>{if(!(!$.current||!M.current)&&!ie.current){q.current(M.current);let O=o||r,C=_(M.current,n||e||"",t||i||"",O||"");f.current=M.current?.editor.create($.current,{model:C,automaticLayout:!0,...p},x),u&&f.current.restoreViewState(z.get(O)),M.current.editor.setTheme(a),s!==void 0&&f.current.revealLine(s),b(!0),ie.current=!0}},[e,t,r,n,i,o,p,x,u,a,s]);c.useEffect(()=>{g&&B.current(f.current,M.current)},[g]),c.useEffect(()=>{!v&&!g&&oe()},[v,g,oe]),h.current=n,c.useEffect(()=>{g&&T&&(U.current?.dispose(),U.current=f.current?.onDidChangeModelContent(O=>{Y.current||T(f.current.getValue(),O)}))},[g,T]),c.useEffect(()=>{if(g){let O=M.current.editor.onDidChangeMarkers(C=>{let Q=f.current.getModel()?.uri;if(Q&&C.find(J=>J.path===Q.path)){let J=M.current.editor.getModelMarkers({resource:Q});m?.(J)}});return()=>{O?.dispose()}}return()=>{}},[g,m]);function Le(){U.current?.dispose(),P?u&&z.set(o,f.current.saveViewState()):f.current.getModel()?.dispose(),f.current.dispose()}return y.createElement(Re,{width:k,height:R,isEditorReady:g,loading:l,_ref:$,className:L,wrapperProps:D})}var Ht=Gt;c.memo(Ht);function Bt(e){return ne({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"},child:[]},{tag:"path",attr:{d:"M9 10h6"},child:[]},{tag:"path",attr:{d:"M12 13V7"},child:[]},{tag:"path",attr:{d:"M9 17h6"},child:[]}]})(e)}function qt(e){return ne({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"},child:[]},{tag:"path",attr:{d:"M14 2v4a2 2 0 0 0 2 2h4"},child:[]},{tag:"path",attr:{d:"M9 15h6"},child:[]}]})(e)}function Wt(e){return ne({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"},child:[]},{tag:"path",attr:{d:"M14 2v4a2 2 0 0 0 2 2h4"},child:[]},{tag:"path",attr:{d:"M9 15h6"},child:[]},{tag:"path",attr:{d:"M12 18v-6"},child:[]}]})(e)}const zt=e=>{switch(e.split(".").pop()?.toLowerCase()){case"js":case"jsx":return"javascript";case"ts":case"tsx":return"typescript";case"py":return"python";case"html":return"html";case"css":return"css";case"json":return"json";case"md":return"markdown";case"yml":case"yaml":return"yaml";case"sh":case"bash":return"bash";case"dockerfile":return"dockerfile";case"rs":return"rust";case"go":return"go";case"java":return"java";case"cpp":case"cc":case"cxx":return"cpp";case"c":return"c";case"rb":return"ruby";case"php":return"php";case"sql":return"sql";default:return"text"}},Kt=e=>c.createElement("svg",{width:13,height:8,viewBox:"0 0 13 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},c.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0.259766 6.17427L6.26425 0.715628L12.2688 6.17427L11.2597 7.28418L6.26425 2.74282L1.26878 7.28418L0.259766 6.17427Z",fill:"currentColor"}));function Zt(e){return{ADDED:"A",DELETED:"D",UPDATED:"M",MOVED:"R"}[e]}class Ae{static buildRuntimeUrl(t,r){return`${De(t)}${r}`}static async getGitChanges(t,r,n){const i=encodeURIComponent(n),o=this.buildRuntimeUrl(t,`/api/git/changes/${i}`),a=ae(r),{data:s}=await se.get(o,{headers:a});return s.map(l=>({status:Zt(l.status),path:l.path}))}static async getGitChangeDiff(t,r,n){const i=encodeURIComponent(n),o=this.buildRuntimeUrl(t,`/api/git/diff/${i}`),a=ae(r),{data:s}=await se.get(o,{headers:a});return s}}function ke(e){if(!e)return"/workspace/project";const t=e.split("/");return`/workspace/project/${t.length>1?t[1]:t[0]}`}const Yt=e=>{const{conversationId:t}=Ee(),{data:r}=je(),n=r?.conversation_version==="V1",i=r?.url,o=r?.session_api_key,a=r?.selected_repository,s=y.useMemo(()=>n?`${ke(a)}/${e.filePath}`:e.filePath,[n,a,e.filePath]);return ye({queryKey:["file_diff",t,e.filePath,e.type,n,i],queryFn:async()=>{if(!t)throw new Error("No conversation ID");return n?Ae.getGitChangeDiff(i,o,s):we.getGitChangeDiff(t,e.filePath)},enabled:e.enabled,staleTime:1e3*60*5,gcTime:1e3*60*15})};function Qt({className:e}){return d.jsx("div",{className:"flex items-center justify-center",children:d.jsx("div",{className:re("animate-spin rounded-full border-4 border-gray-200 border-t-blue-500",e),role:"status","aria-label":"Loading"})})}const ge={A:Wt,D:qt,M:Bt,R:"Renamed",U:"Untracked"};function Jt({path:e,type:t}){const[r,n]=y.useState(!0),[i,o]=y.useState(400),a=y.useRef(null),s=t==="A"||t==="U",l=t==="D",p=y.useMemo(()=>{if(t==="R"){const m=e.split(/\s+/).slice(1);return m[m.length-1]}return e},[e,t]),{data:x,isLoading:u,isSuccess:P,isRefetching:k}=Yt({filePath:p,type:t,enabled:!r}),R=y.useCallback(()=>{if(a.current){const m=a.current.getOriginalEditor(),g=a.current.getModifiedEditor();if(m&&g){const b=m.getContentHeight(),v=g.getContentHeight(),N=Math.max(b,v);o(N+20)}}},[]),L=m=>{m.editor.defineTheme("custom-diff-theme",{base:"vs-dark",inherit:!0,rules:[{token:"comment",foreground:"6a9955"},{token:"keyword",foreground:"569cd6"},{token:"string",foreground:"ce9178"},{token:"number",foreground:"b5cea8"}],colors:{"diffEditor.insertedTextBackground":"#014b01AA","diffEditor.removedTextBackground":"#750000AA","diffEditor.insertedLineBackground":"#003f00AA","diffEditor.removedLineBackground":"#5a0000AA","diffEditor.border":"#444444","editorUnnecessaryCode.border":"#00000000","editorUnnecessaryCode.opacity":"#00000077"}})},D=m=>{a.current=m,R();const g=m.getOriginalEditor(),b=m.getModifiedEditor();g.onDidContentSizeChange(R),b.onDidContentSizeChange(R)},S=(t==="U"?ge.A:ge[t])||"?";let w;if(typeof S=="string")w=d.jsx("span",{children:S});else{const m=S;w=d.jsx(m,{className:"w-5 h-5"})}const T=u||k;return d.jsxs("div",{"data-testid":"file-diff-viewer-outer",className:"w-full flex flex-col",children:[d.jsx("div",{className:re("flex justify-between items-center px-2.5 py-3.5 border border-neutral-600 rounded-xl hover:cursor-pointer",!r&&!u&&"border-b-0 rounded-b-none"),onClick:()=>n(m=>!m),children:d.jsxs("span",{className:"text-sm w-full text-content flex items-center gap-2",children:[T&&d.jsx(Qt,{className:"w-5 h-5"}),!T&&w,d.jsx("strong",{className:"w-full truncate",children:p}),d.jsx("button",{"data-testid":"collapse",type:"button",children:d.jsx(Kt,{className:re("w-4 h-4 transition-transform",r&&"transform rotate-180")})})]})}),P&&!r&&d.jsx("div",{className:"w-full border border-neutral-600 overflow-hidden",style:{height:`${i}px`},children:d.jsx(Ut,{"data-testid":"file-diff-viewer",className:"w-full h-full",language:zt(p),original:s?"":x.original,modified:l?"":x.modified,theme:"custom-diff-theme",onMount:D,beforeMount:L,options:{renderValidationDecorations:"off",readOnly:!0,renderSideBySide:!s&&!l,scrollBeyondLastLine:!1,minimap:{enabled:!1},hideUnchangedRegions:{enabled:!0},automaticLayout:!0,scrollbar:{alwaysConsumeMouseWheel:!1}}})})]})}const Xt=()=>{const{conversationId:e}=Ee(),{data:t}=je(),[r,n]=y.useState([]),i=y.useRef(null),o=$e(),a=t?.conversation_version==="V1",s=t?.url,l=t?.session_api_key,p=t?.selected_repository,x=y.useMemo(()=>ke(p),[p]),u=ye({queryKey:["file_changes",e,a,s,x],queryFn:async()=>{if(!e)throw new Error("No conversation ID");return a?Ae.getGitChanges(s,l,x):we.getGitChanges(e)},retry:!1,staleTime:1e3*60*5,gcTime:1e3*60*15,enabled:o&&!!e,meta:{disableToast:!0}});return y.useEffect(()=>{if(!u.isFetching&&u.isSuccess&&u.data){const P=u.data;if(P!==i.current)if(i.current=P,Array.isArray(P)){const k=new Set(P.map(S=>S.path)),R=new Set(r.map(S=>S.path)),L=P.filter(S=>!R.has(S.path)),D=r.filter(S=>k.has(S.path));n([...L,...D])}else n([P])}},[u.isFetching,u.isSuccess,u.data]),{data:r,isLoading:u.isLoading,isSuccess:u.isSuccess,isError:u.isError,error:u.error}},me=[{key:j.TIPS$CUSTOMIZE_MICROAGENT,link:"https://docs.all-hands.dev/usage/prompting/microagents-repo"},{key:j.TIPS$SETUP_SCRIPT,link:"https://docs.all-hands.dev/usage/prompting/repository#setup-script"},{key:j.TIPS$VSCODE_INSTANCE},{key:j.TIPS$SAVE_WORK},{key:j.TIPS$SPECIFY_FILES,link:"https://docs.all-hands.dev/usage/prompting/prompting-best-practices"},{key:j.TIPS$HEADLESS_MODE,link:"https://docs.all-hands.dev/usage/how-to/headless-mode"},{key:j.TIPS$CLI_MODE,link:"https://docs.all-hands.dev/usage/how-to/cli-mode"},{key:j.TIPS$GITHUB_HOOK,link:"https://docs.all-hands.dev/usage/cloud/github-installation#working-on-github-issues-and-pull-requests-using-openhands"},{key:j.TIPS$BLOG_SIGNUP,link:"https://www.all-hands.dev/blog"},{key:j.TIPS$API_USAGE,link:"https://docs.all-hands.dev/api-reference/health-check"}];function ve(){const e=Math.floor(Math.random()*me.length);return me[e]}function er(){const{t:e}=Se(),[t,r]=y.useState(ve());return y.useEffect(()=>{r(ve())},[]),d.jsxs("p",{children:[d.jsxs("h4",{className:"font-bold",children:[e(j.TIPS$PROTIP),":"]}),e(t.key),t.link&&d.jsxs(d.Fragment,{children:[" ",d.jsx("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:"underline",children:e(j.TIPS$LEARN_MORE)})]})]})}const be=/not a git repository/i;function tr({children:e}){return d.jsx("div",{className:"w-full h-full flex flex-col items-center text-center justify-center text-2xl text-tertiary-light",children:e})}function zr(){const{t:e}=Se(),{data:t,isSuccess:r,isError:n,error:i,isLoading:o}=Xt(),[a,s]=y.useState(null),{curAgentState:l}=_e(),p=!Ne.includes(l),x=i&&be.test(ce(i));return y.useEffect(()=>{if(!p)s([j.DIFF_VIEWER$WAITING_FOR_RUNTIME]);else if(i){const u=ce(i);be.test(u)?s([j.DIFF_VIEWER$NOT_A_GIT_REPO,j.DIFF_VIEWER$ASK_OH]):s([u])}else s(o?[j.DIFF_VIEWER$LOADING]:null)},[p,x,o,i,s]),d.jsx("main",{className:"h-full overflow-y-scroll p-4 md:pr-1.5 gap-3 flex flex-col items-center custom-scrollbar-always",children:!r||!t.length?d.jsxs("div",{className:"relative flex h-full w-full items-center",children:[d.jsx("div",{className:"absolute inset-x-0 top-1/2 -translate-y-1/2",children:a&&d.jsx(tr,{children:a.map(u=>d.jsx("span",{children:e(u)},u))})}),d.jsx("div",{className:"absolute inset-x-0 bottom-0",children:!n&&t?.length===0&&d.jsx("div",{className:"max-w-2xl mb-4 text-m bg-tertiary rounded-xl p-4 text-left mx-auto",children:d.jsx(er,{})})})]}):t.slice(0,100).map(u=>d.jsx(Jt,{path:u.path,type:u.status},u.path))})}export{zr as default};
