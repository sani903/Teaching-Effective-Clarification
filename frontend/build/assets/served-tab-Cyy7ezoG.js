import{R as n,p as t}from"./chunk-NISHYRIK-CgksP-ke.js";import{k as w}from"./index-CQq-b-9n.js";import{d as R,f as j}from"./index-DastLBCt.js";import{b as S,u as A,a8 as N}from"./parse-pr-url-CCSuKL2A.js";import{a as C}from"./use-config-BtaDlBUv.js";import{a as E}from"./open-hands-axios-DsgPCc-0.js";import{C as I}from"./feature-flags-1f3MRGYs.js";import{u as L,b as k}from"./conversation-BJC1AsS5.js";import{u as D}from"./use-batch-sandboxes-BSkeku7q.js";import{I as g}from"./declaration-BLNM_M5s.js";import{S as H}from"./server-process-BvykxQDk.js";import{u as F}from"./useTranslation-BhtO8iYN.js";import"./gestures-BcGXZsOZ.js";import"./index-BBSevn_K.js";import"./utils-C5iw9p3M.js";import"./module-CWLbpm_7.js";import"./index-DJ6Yt2gU.js";import"./optimistic-user-message-store-BLUkFBLR.js";import"./brand-button-BLaTuvKj.js";import"./query-client-config-D_0Qd0_c.js";import"./i18next-Lgj2Bm8L.js";import"./retrieve-axios-error-message-CYr77e_f.js";import"./custom-toast-handlers-B_1yfMGT.js";import"./option-service.api-L97_35Hu.js";import"./infiniteQueryBehavior-D4OZgA3F.js";import"./use-user-providers-CPbKIWnc.js";import"./use-settings-y2Eq7ITW.js";import"./use-is-authed-CJdzFdqm.js";import"./close-_PwA9ZeD.js";import"./useSingleSelectListState-D8PQAT0i.js";import"./preload-helper-BhQ1_4_d.js";import"./middleware-BNIo_uWn.js";import"./index-JS6LK1M2.js";import"./index-0urWFDHv.js";import"./base-modal-LOTJhsuL.js";import"./modal-body-DfkwqNDR.js";import"./modal-backdrop-CfHRd2ER.js";import"./tooltip-button-CGDIzzom.js";import"./typography-DvyHXuI5.js";import"./repo-forked-Bc3iCQ5X.js";import"./index-Cfwn16jo.js";import"./Trans-CSq1Url9.js";import"./settings-dropdown-input-DCArA_yj.js";import"./optional-tag-C2att6n-.js";import"./chunk-S6H5EOGR-BBckzTk7.js";import"./loading-spinner-CE6B7tvy.js";const _=()=>{const[i,m]=n.useState(null),{conversationId:e}=S(),c=L(),{data:p}=A(),{data:f,isLoading:x}=k(),a=p?.conversation_version==="V1",s=f?.runtime_id,r=D(s?[s]:[]),{data:d,isLoading:l}=C({queryKey:[e,"unified","hosts",a,s],queryFn:async()=>a?!r.data||r.data.length===0||!r.data[0]?{hosts:[]}:{hosts:r.data[0].exposed_urls?.filter(y=>y.name.startsWith("WORKER_")).map(y=>y.url)||[]}:{hosts:await I.getWebHosts(e)},enabled:c&&!!e&&(!a||!!r.data),initialData:{hosts:[]},meta:{disableToast:!0}}),u=N({queries:d.hosts.map(o=>({queryKey:[e,"unified","hosts",o],queryFn:async()=>{try{return await E.get(o),o}catch{return""}},refetchInterval:3e3,meta:{disableToast:!0}}))}).map(o=>o.data);n.useEffect(()=>{const o=u.find(b=>b);m(o||"")},[u]);const h=a&&(x||r.isLoading)||l;return{activeHost:i,isLoading:h}};function K({ref:i,onBlur:m,defaultValue:e}){return t.jsx("form",{ref:i,onSubmit:c=>c.preventDefault(),className:"flex-1",children:t.jsx("input",{name:"url",type:"text",defaultValue:e,className:"w-full bg-transparent",onBlur:m})})}function Lt(){const{t:i}=F(),{activeHost:m}=_(),[e,c]=n.useState(0),[p,f]=n.useState(null),[x,a]=n.useState("hello"),s=n.useRef(null),r=()=>{if(s.current){const u=new FormData(s.current).get("url")?.toString();if(u){const h=new URL(u);f(h.origin),a(h.pathname)}}},d=()=>{f(m),a(""),s.current&&s.current.reset()};n.useEffect(()=>{d()},[m]);const l=`${p}/${x}`;return p?t.jsxs("div",{className:"h-full w-full",children:[t.jsxs("div",{className:"w-full p-2 flex items-center gap-4 border-b border-neutral-600",children:[t.jsx("button",{type:"button",onClick:()=>window.open(l,"_blank"),className:"text-sm",children:t.jsx(R,{className:"w-4 h-4"})}),t.jsx("button",{type:"button",onClick:()=>c(v=>v+1),className:"text-sm",children:t.jsx(w,{className:"w-4 h-4"})}),t.jsx("button",{type:"button",onClick:()=>d(),className:"text-sm",children:t.jsx(j,{className:"w-4 h-4"})}),t.jsx("div",{className:"w-full flex",children:t.jsx(K,{ref:s,onBlur:r,defaultValue:l})})]}),t.jsx("iframe",{title:i(g.SERVED_APP$TITLE),src:l,className:"w-full h-full custom-scrollbar-always"},e)]}):t.jsxs("div",{className:"flex flex-col items-center justify-center w-full h-full p-10",children:[t.jsx(H,{width:113,height:113,color:"#A1A1A1"}),t.jsx("span",{className:"text-[#8D95A9] text-[19px] font-normal leading-5",children:i(g.BROWSER$SERVER_MESSAGE)})]})}export{Lt as default};
