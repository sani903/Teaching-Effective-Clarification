import{r,p as e,t as oe,C as Oe,y as Y,R as H,w as ye}from"./chunk-NISHYRIK-CgksP-ke.js";import{u as P}from"./useTranslation-BhtO8iYN.js";import{T as Q}from"./typography-DvyHXuI5.js";import{B as J}from"./brand-button-BLaTuvKj.js";import{u as Te}from"./use-settings-y2Eq7ITW.js";import{S as X}from"./repo-forked-Bc3iCQ5X.js";import{I as S}from"./declaration-BLNM_M5s.js";import{c as Ie,u as ee,a as Pe,G as ke}from"./optimistic-user-message-store-BLUkFBLR.js";import{u as ce,r as Ae,n as Le,o as He}from"./open-hands-axios-DsgPCc-0.js";import{u as de}from"./use-user-providers-CPbKIWnc.js";import{G as ue,E as me,D as xe,u as pe,a as he,T as fe,b as ge,c as De,d as $e,e as Ve}from"./use-search-repositories-D5GOcXmI.js";import{c as T,g as Ge,b as Ue}from"./utils-C5iw9p3M.js";import{u as Fe}from"./useInfiniteQuery-DoKcZZP5.js";import{G as te}from"./git-service.api-C9ZaYUVf.js";import{a as Ne,u as Ke}from"./use-config-BtaDlBUv.js";import{S as je,p as We,c as Be}from"./middleware-BNIo_uWn.js";import{b as qe,a as Ze,c as ze}from"./index-CQq-b-9n.js";import{u as Ye,S as Qe,C as Je,f as Xe,a as et,b as tt}from"./format-time-delta-XCy4G5Sb.js";import{c as be}from"./index-0urWFDHv.js";import"./module-CWLbpm_7.js";import"./use-is-authed-CJdzFdqm.js";import"./feature-flags-1f3MRGYs.js";import"./infiniteQueryBehavior-D4OZgA3F.js";import"./option-service.api-L97_35Hu.js";import"./tooltip-button-CGDIzzom.js";import"./preload-helper-BhQ1_4_d.js";import"./index-BBSevn_K.js";function st(t,n){const s=ce(n);return nt({filters:{...t,status:"pending"}},s).length}function le(t,n){return t.findAll(n.filters).map(s=>n.select?n.select(s):s.state)}function nt(t={},n){const s=ce(n).getMutationCache(),a=r.useRef(t),l=r.useRef(null);return l.current||(l.current=le(s,t)),r.useEffect(()=>{a.current=t}),r.useSyncExternalStore(r.useCallback(d=>s.subscribe(()=>{const c=Ae(l.current,le(s,a.current));l.current!==c&&(l.current=c,Le.schedule(d))}),[s]),()=>l.current,()=>l.current)}function at(){const{t}=P();return e.jsxs("div",{className:"w-fit flex flex-col md:flex-row items-start md:items-center justify-center gap-1 rounded-[12px] bg-[#454545] leading-5 text-white text-[15px] font-normal m-1 md:h-9.5 px-4 pb-1 md:px-[15px] md:py-0",children:[e.jsxs("span",{className:"",children:[t("HOME$GUIDE_MESSAGE_TITLE")," "]}),e.jsx("a",{href:"https://docs.all-hands.dev/usage/getting-started",target:"_blank",rel:"noopener noreferrer",children:e.jsx("span",{className:"underline",children:t("COMMON$CLICK_HERE")})})]})}function lt(){const{t}=P();return e.jsx("div",{className:"h-[80px] flex items-center",children:e.jsx(Q.H1,{children:t("HOME$LETS_START_BUILDING")})})}function rt(){return e.jsxs("header",{className:"flex flex-col items-center gap-12",children:[e.jsx(at,{}),e.jsx(lt,{})]})}function it(){const{isLoading:t}=Te(),{t:n}=P();return e.jsxs("div",{className:"flex flex-col gap-4 justify-between h-full",children:[e.jsxs("div",{className:"flex flex-col gap-2.5",children:[e.jsxs("div",{className:"flex items-center gap-[10px]",children:[e.jsx(X,{width:24,height:24}),e.jsx("span",{className:"leading-5 font-bold text-base text-white",children:n(S.COMMON$OPEN_REPOSITORY)})]}),e.jsx("p",{children:n("HOME$CONNECT_PROVIDER_MESSAGE")})]}),e.jsx(oe,{"data-testid":"navigate-to-settings-button",to:"/settings/integrations",className:"self-start w-full",children:e.jsxs(J,{type:"button",variant:"primary",isDisabled:t,className:"w-full font-semibold",children:[!t&&n("SETTINGS$TITLE"),t&&n("HOME$LOADING")]})})]})}const se=()=>{const t=Oe(),n=st({mutationKey:["create-conversation"]}),s=!!t.location;return n>0||s},ot=(t,n=30)=>Fe({queryKey:["repository",t,"branches","paginated",n],queryFn:async({pageParam:s=1})=>t?te.getRepositoryBranches(t,s,n):{branches:[],has_next_page:!1,current_page:1,per_page:n,total_count:0},enabled:!!t,staleTime:1e3*60*5,getNextPageParam:s=>s.has_next_page?s.current_page+1:void 0,initialPageParam:1});function re(t,n,s=30,a){return Ne({queryKey:["repository",t,"branches","search",n,s,a],queryFn:async()=>!t||!n?[]:te.searchRepositoryBranches(t,n,s,a),enabled:!!t&&!!n,staleTime:1e3*60*5,gcTime:1e3*60*15})}function ct(t,n,s,a,l,d){const{data:c,fetchNextPage:i,hasNextPage:o,isLoading:m,isFetchingNextPage:u,isError:x}=ot(t),{data:N,isLoading:w}=re(t,a,30,n),f=r.useMemo(()=>c?.pages?.flatMap(j=>j.branches)||[],[c]),g=r.useMemo(()=>s?f.find(j=>j.name===s):null,[f,s]),h=s&&!g&&f.length>0&&!a,{data:b,isLoading:R}=re(t,h?s:"",30,n);return{branches:r.useMemo(()=>{const j=a&&N&&!(d&&l===d.name);let _=j?N:f;if(s){let v=j?_.find(M=>M.name===s):g;if(!v&&b&&b.length>0)v=b.find(M=>M.name===s),v&&(_=[v,..._]);else if(v){const M=_.filter(A=>A.name!==s);_=[v,...M]}}return _},[a,N,f,d,l,s,g,b]),allBranches:f,fetchNextPage:i,hasNextPage:o,isLoading:m||R,isFetchingNextPage:u,isError:x,isSearchLoading:w}}function ve({disabled:t,onClear:n,testId:s="dropdown-clear"}){return e.jsx("button",{onClick:a=>{a.stopPropagation(),n()},disabled:t,className:T("p-1 text-[#fff]","cursor-pointer disabled:cursor-not-allowed disabled:opacity-60"),type:"button","aria-label":"Clear selection","data-testid":s,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}function dt({isOpen:t,filteredBranches:n,inputValue:s,highlightedIndex:a,selectedItem:l,getMenuProps:d,getItemProps:c,onScroll:i,menuRef:o}){const m=(x,N,w,f,g)=>e.jsx(xe,{item:x,index:N,isSelected:f?.name===x.name,getItemProps:g,getDisplayText:h=>h.name,getItemKey:h=>h.name},x.name),u=x=>e.jsx("li",{className:"px-3 py-2",children:e.jsx(me,{inputValue:x,searchMessage:"No branches found",emptyMessage:"No branches available",testId:"git-branch-dropdown-empty"})});return e.jsx("div",{"data-testid":"git-branch-dropdown-menu",children:e.jsx(ue,{isOpen:t,filteredItems:n,inputValue:s,highlightedIndex:a,selectedItem:l,getMenuProps:d,getItemProps:c,onScroll:i,menuRef:o,renderItem:m,renderEmptyState:u})})}function ut({repository:t,provider:n,selectedBranch:s,onBranchSelect:a,defaultBranch:l,placeholder:d="Select branch...",disabled:c=!1,className:i}){const[o,m]=r.useState(""),[u,x]=r.useState(!1),N=pe(o,300),w=r.useRef(null),f=r.useMemo(()=>N.trim().length>0?N.trim():"",[N]),{branches:g,isLoading:h,isError:b,fetchNextPage:R,hasNextPage:C,isFetchingNextPage:j,isSearchLoading:_}=ct(t,n,l||null,f,o,s),v=b?new Error("Failed to load branches"):null,M=r.useCallback(()=>{m(""),a(null),x(!0)},[a]),A=r.useCallback(E=>{a(E),m("")},[a]),U=r.useCallback(({inputValue:E})=>{E!==void 0&&m(E)},[]),F=r.useCallback(E=>{const{scrollTop:$,scrollHeight:q,clientHeight:Z}=E.currentTarget;q-$<=Z*1.5&&C&&!j&&R()},[C,j,R]),{isOpen:y,selectedItem:V,highlightedIndex:G,getInputProps:D,getItemProps:K,getMenuProps:W,getToggleButtonProps:B}=he({items:g,selectedItem:s,itemToString:E=>E?.name||"",onSelectedItemChange:({selectedItem:E})=>{A(E||null)},onInputValueChange:U,inputValue:o});r.useEffect(()=>{t&&(a(null),x(!1))},[t,a]),r.useEffect(()=>{if(t&&l&&!s&&!u&&g.length>0&&!h){const E=g.find($=>$.name===l);E&&a(E)}},[t,l,s,u,g,a,h]),r.useEffect(()=>{m("")},[t]),r.useEffect(()=>{s&&!y&&o!==s.name?m(s.name):!s&&!y&&o&&m("")},[s,y,o]);const L=h||_||j;return e.jsxs("div",{className:T("relative",i),children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-2 top-1/2 transform -translate-y-1/2 z-10",children:L?e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-blue-500 border-t-transparent rounded-full"}):e.jsx(je,{width:16,height:16})}),e.jsx("input",{...D({disabled:c||!t,placeholder:d,className:T("w-full px-3 py-2 border border-[#727987] rounded-sm shadow-none h-[42px] min-h-[42px] max-h-[42px]","bg-[#454545] text-[#A3A3A3] placeholder:text-[#A3A3A3]","focus:outline-none focus:ring-0 focus:border-[#727987]","disabled:bg-[#363636] disabled:cursor-not-allowed disabled:opacity-60","pl-7 pr-16 text-sm font-normal leading-5")}),"data-testid":"git-branch-dropdown-input"}),e.jsxs("div",{className:"absolute right-1 top-1/2 transform -translate-y-1/2 flex items-center",children:[s&&e.jsx(ve,{disabled:c,onClear:M}),e.jsx(fe,{isOpen:y,disabled:c||!t,getToggleButtonProps:B,iconClassName:"w-10 h-10"})]})]}),e.jsx(dt,{isOpen:y,filteredBranches:g,inputValue:o,highlightedIndex:G,selectedItem:V,getMenuProps:W,getItemProps:K,onScroll:F,menuRef:w}),e.jsx(ge,{isError:!!v})]})}const mt={github:"github"};function xt(t,n){const[s,a]=r.useState([]),[l,d]=r.useState(!1);return r.useEffect(()=>{(async()=>{if(t.startsWith("https://")){const i=t.match(/https:\/\/[^/]+\/([^/]+\/[^/]+)/);if(i){const o=i[1];d(!0);try{const m=await te.searchGitRepositories(o,3,n);a(m)}catch{a([])}finally{d(!1)}}}else a([])})()},[t,n]),{urlSearchResults:s,isUrlSearchLoading:l}}function pt(t,n,s,a,l,d,c){const{data:i,fetchNextPage:o,hasNextPage:m,isLoading:u,isFetchingNextPage:x,isError:N}=De({provider:t,enabled:!n}),w=r.useMemo(()=>l===c,[c,l]),{data:f,isLoading:g}=$e(s,t,w),h=r.useMemo(()=>i?.pages?.flatMap(C=>C.data)||[],[i]),b=r.useMemo(()=>d&&[...h,...a,...f||[]].find(j=>j.id===d)||null,[h,a,f,d]),R=r.useMemo(()=>a.length>0?a:s&&f&&!(b&&l===b.full_name)?f:h,[a,s,f,h,b,l]);return r.useEffect(()=>{!n&&!u&&!x&&!g&&m&&!s&&a.length===0&&R.length>0&&R.length<10&&o()},[n,u,x,g,m,s,a.length,R.length,o]),{repositories:R,allRepositories:h,selectedRepository:b,fetchNextPage:o,hasNextPage:m,isLoading:u,isFetchingNextPage:x,isError:N,isSearchLoading:g}}const ht=t=>r.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",...t},r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21 15V2.25L20.25 1.5H5.60999C5.26596 1.50381 4.92547 1.56987 4.60499 1.695C4.28194 1.83856 3.99081 2.0452 3.74868 2.30278C3.50656 2.56036 3.31831 2.8637 3.19499 3.195C3.07229 3.49004 3.00614 3.80552 2.99999 4.125V18.375C2.99638 18.7197 3.06272 19.0616 3.19499 19.38C3.46049 20.0205 3.96749 20.532 4.60499 20.805C4.92547 20.9301 5.26596 20.9962 5.60999 21H5.99999V19.5H5.60999C5.46032 19.5005 5.31218 19.4698 5.17499 19.41C4.90342 19.2974 4.68763 19.0816 4.57499 18.81C4.52706 18.6699 4.50174 18.5231 4.49999 18.375V17.625C4.50174 17.4769 4.52706 17.3301 4.57499 17.19C4.68763 16.9184 4.90342 16.7026 5.17499 16.59C5.31033 16.531 5.45634 16.5004 5.60399 16.5H19.5V19.5H13.5V21H20.25L21 20.25V15ZM5.99999 15V3H19.5V15H5.99999ZM7.49999 4.5H8.99999V6H7.49999V4.5ZM7.49999 7.5H8.99999V9H7.49999V7.5ZM8.99999 10.5H7.49999V12H8.99999V10.5ZM9.74999 20.235L7.91999 22.5H7.49999V18H12V22.5H11.58L9.74999 20.235Z",fill:"currentColor"})),ft={recentRepositories:[]},Se=Ie()(We((t,n)=>({...ft,addRecentRepository:s=>t(a=>{const l=a.recentRepositories.filter(c=>c.id!==s.id);return{recentRepositories:[s,...l].slice(0,3)}}),clearRecentRepositories:()=>t(()=>({recentRepositories:[]})),getRecentRepositories:()=>n().recentRepositories}),{name:"home-store",storage:Be(()=>localStorage)}));function gt({provider:t,value:n,repositoryName:s,placeholder:a="Search repositories...",className:l,disabled:d=!1,onChange:c}){const{t:i}=P(),{data:o}=Ke(),{recentRepositories:m}=Se(),[u,x]=r.useState(""),[N,w]=r.useState(null),f=pe(u,300),g=r.useRef(null),h=r.useMemo(()=>{if(f.startsWith("https://")){const p=f.match(/https:\/\/[^/]+\/([^/]+\/[^/]+)/);return p?p[1]:f}return f},[f]),{urlSearchResults:b,isUrlSearchLoading:R}=xt(u,t),{repositories:C,selectedRepository:j,fetchNextPage:_,hasNextPage:v,isLoading:M,isFetchingNextPage:A,isError:U,isSearchLoading:F}=pt(t,d,h,b,u,n,s),y=r.useMemo(()=>{const O=m.filter(I=>I.git_provider===t);if(!u||!u.trim())return O;const k=u.startsWith("https://")?h:u;return O.filter(I=>I.full_name.toLowerCase().includes(k.toLowerCase()))},[m,t,u,h]),V=r.useCallback(p=>{const O=new Set(y.map(I=>I.id)),k=p.filter(I=>!O.has(I.id));return[...y,...k]},[y]),G=r.useMemo(()=>{let p;if(b.length>0)p=C;else if(j&&u===j.full_name)p=C;else if(!u||!u.trim())p=C;else{const O=u.startsWith("https://")?h:u;p=C.filter(k=>k.full_name.toLowerCase().includes(O.toLowerCase()))}return V(p)},[C,u,j,b,h,V]),D=r.useCallback(p=>{w(p),c?.(p||void 0),p&&x(p.full_name)},[c]),K=r.useCallback(()=>{w(null),D(null),x("")},[D]),W=r.useCallback(({inputValue:p})=>{x(p||"")},[]),B=r.useCallback(p=>{const{scrollTop:O,scrollHeight:k,clientHeight:I}=p.currentTarget;O+I>=k-10&&v&&!A&&_()},[v,A,_]),{isOpen:L,getToggleButtonProps:E,getMenuProps:$,getInputProps:q,highlightedIndex:Z,getItemProps:ne,selectedItem:Ce}=he({items:G,itemToString:p=>p?.full_name||"",selectedItem:N,onSelectedItemChange:({selectedItem:p})=>{D(p)},onInputValueChange:W,inputValue:u});r.useEffect(()=>{j?w(j):n===null&&w(null)},[j,n]),r.useEffect(()=>{j&&!L&&x(j.full_name)},[j,L]);const we=M||F||A||R,Ee=r.useMemo(()=>{if(!o||!o.APP_SLUG||t!==mt.github||o.APP_MODE!=="saas")return null;const p=`https://github.com/apps/${o.APP_SLUG}/installations/new`;return e.jsx("a",{href:p,target:"_blank",rel:"noopener noreferrer",className:"flex items-center w-full px-2 py-2 text-sm text-white hover:bg-[#5C5D62] rounded-md transition-colors duration-150 font-normal",onMouseDown:O=>{O.preventDefault(),O.stopPropagation()},children:i(S.HOME$ADD_GITHUB_REPOS)})},[t,o,i]),Re=(p,O,k,I,ae)=>e.jsx(xe,{item:p,index:O,isSelected:I?.id===p.id,getItemProps:ae,getDisplayText:z=>z.full_name,getItemKey:z=>z.id},p.id),_e=p=>e.jsx(me,{inputValue:p,searchMessage:i(S.HOME$NO_REPOSITORY_FOUND),emptyMessage:i(S.COMMON$NO_REPOSITORY),testId:"git-repo-dropdown-empty"}),Me=r.useMemo(()=>y.length===0?null:e.jsx("div",{children:e.jsx(Q.Text,{className:"text-xs text-[#FAFAFA] font-semibold leading-4 pl-2",children:i(S.COMMON$MOST_RECENT)})}),[y,N,ne,i]);return e.jsxs("div",{className:T("relative",l),children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-2 top-1/2 transform -translate-y-1/2 z-10",children:we?e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-blue-500 border-t-transparent rounded-full"}):e.jsx(ht,{width:16,height:16})}),e.jsx("input",{...q({disabled:d,placeholder:a,className:T("w-full px-3 py-2 border border-[#727987] rounded-sm shadow-none h-[42px] min-h-[42px] max-h-[42px]","bg-[#454545] text-[#A3A3A3] placeholder:text-[#A3A3A3]","focus:outline-none focus:ring-0 focus:border-[#727987]","disabled:bg-[#363636] disabled:cursor-not-allowed disabled:opacity-60","pl-7 pr-16 text-sm font-normal leading-5")}),"data-testid":"git-repo-dropdown"}),e.jsxs("div",{className:"absolute right-1 top-1/2 transform -translate-y-1/2 flex items-center",children:[j&&e.jsx(ve,{disabled:d,onClear:K}),e.jsx(fe,{isOpen:L,disabled:d,getToggleButtonProps:E,iconClassName:"w-10 h-10"})]})]}),e.jsx(ue,{isOpen:L,filteredItems:G,inputValue:u,highlightedIndex:Z,selectedItem:Ce,getMenuProps:$,getItemProps:ne,onScroll:B,menuRef:g,renderItem:Re,renderEmptyState:_e,stickyTopItem:Me,stickyFooterItem:Ee,testId:"git-repo-dropdown-menu",numberOfRecentItems:y.length}),e.jsx(ge,{isError:U})]})}function Nt({onRepoSelection:t,isLoadingSettings:n=!1}){const s=Y(),[a,l]=H.useState(null),[d,c]=H.useState(null),[i,o]=H.useState(null),{providers:m}=de(),{addRecentRepository:u}=Se(),{mutate:x,isPending:N,isSuccess:w}=ee(),f=se(),{t:g}=P();H.useEffect(()=>{m.length===1&&!i&&o(m[0])},[m,i]);const h=N||w||f,b=v=>{v!==i&&(o(v),l(null),c(null),t(null))},R=H.useCallback(v=>{c(v)},[]),C=()=>m.length<=1?null:e.jsx(Ve,{providers:m,value:i,placeholder:"Select Provider",className:"max-w-[500px]",onChange:b,disabled:n}),j=()=>{const v=M=>{M?(t(M),l(M)):(t(null),l(null),c(null))};return e.jsx(gt,{provider:i||m[0],value:a?.id||null,repositoryName:a?.full_name||null,placeholder:"user/repo",disabled:!i||n,onChange:v,className:"max-w-auto"})},_=()=>{const v=a?.main_branch||null;return e.jsx(ut,{repository:a?.full_name||null,provider:i||m[0],selectedBranch:d,onBranchSelect:R,defaultBranch:v,placeholder:"Select branch...",className:"max-w-[500px]",disabled:!a||n})};return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-[10px] pb-4",children:[e.jsx(X,{width:24,height:24}),e.jsx("span",{className:"leading-5 font-bold text-base text-white",children:g(S.COMMON$OPEN_REPOSITORY)})]})}),e.jsxs("div",{className:"flex flex-col gap-[10px] pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-white font-normal leading-[22px]",children:g(S.HOME$SELECT_OR_INSERT_URL)}),C()]}),j(),_()]}),e.jsxs(J,{testId:"repo-launch-button",variant:"primary",type:"button",isDisabled:!a||!d||h||m.length>1&&!i||n,onClick:()=>{a&&u(a),x({repository:{name:a?.full_name||"",gitProvider:a?.git_provider||"github",branch:d?.name||"main"}},{onSuccess:v=>s(`/conversations/${v.conversation_id}`)})},className:"w-full font-semibold",children:[!h&&"Launch",h&&g("HOME$LOADING")]})]})}function jt({onRepoSelection:t}){const{providers:n,isLoadingSettings:s}=de(),a=n.length>0;return e.jsxs("section",{"data-testid":"repo-connector",className:"w-full flex flex-col gap-6 rounded-[12px] p-[20px] border border-[#727987] bg-[#26282D] min-h-[263.5px] relative",children:[!a&&e.jsx(it,{}),a&&e.jsx(Nt,{onRepoSelection:t,isLoadingSettings:s})]})}function bt({href:t,issueNumber:n}){return e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer","data-testid":"task-id",children:e.jsxs("span",{className:"text-xs text-[#A3A3A3] leading-4 font-normal",children:["#",n]})})}const vt=t=>({FAILING_CHECKS:t("HOME$FIX_FAILING_CHECKS"),MERGE_CONFLICTS:t("HOME$RESOLVE_MERGE_CONFLICTS"),OPEN_ISSUE:t("HOME$OPEN_ISSUE"),UNRESOLVED_COMMENTS:t("HOME$RESOLVE_UNRESOLVED_COMMENTS")});function St({task:t}){const{setOptimisticUserMessage:n}=Pe(),{mutate:s}=ee(),a=se(),{t:l}=P(),d=Y(),c=()=>(n(l("TASK$ADDRESSING_TASK")),s({repository:{name:t.repo,gitProvider:t.git_provider},suggestedTask:t},{onSuccess:o=>{d(`/conversations/${o.conversation_id}`)}}));let i;if(t.git_provider==="gitlab"){const o=t.task_type==="OPEN_ISSUE"?"issues":"merge_requests";i=`https://gitlab.com/${t.repo}/-/${o}/${t.issue_number}`}else if(t.git_provider==="bitbucket"){const o=t.task_type==="OPEN_ISSUE"?"issues":"pull-requests";i=`https://bitbucket.org/${t.repo}/${o}/${t.issue_number}`}else{const o=t.task_type==="OPEN_ISSUE"?"issues":"pull";i=`https://github.com/${t.repo}/${o}/${t.issue_number}`}return e.jsx("button",{type:"button","data-testid":"task-launch-button",className:T("w-full p-[14px] text-left flex items-center justify-between cursor-pointer hover:bg-[#5C5D62] transition-all duration-300 rounded-lg",a&&"cursor-not-allowed"),disabled:a,onClick:c,children:e.jsxs("div",{className:"flex items-center gap-3 min-w-0 w-full",children:[e.jsx(bt,{issueNumber:t.issue_number,href:i}),e.jsxs("div",{className:"flex flex-col gap-1 min-w-0 flex-1",children:[e.jsx("span",{className:"text-xs text-white leading-6 font-normal truncate",children:vt(l)[t.task_type]}),e.jsx("span",{className:"text-xs text-[#A3A3A3] leading-4 font-normal max-w-70 truncate",title:t.title,children:t.title})]})]})})}function Ct({children:t}){return e.jsx("div",{className:"py-3",children:e.jsx("h3",{className:"text-xs text-white leading-6 font-normal",children:t})})}function wt({title:t,tasks:n}){const s=n.length>0?n[0].git_provider:null;return e.jsxs("div",{className:"text-content-2 px-[14px]",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b-1 border-[#717888] mb-2",children:[s==="github"&&e.jsx(qe,{size:14}),s==="gitlab"&&e.jsx(Ze,{}),s==="bitbucket"&&e.jsx(ze,{}),e.jsx(Ct,{children:t})]}),e.jsx("ul",{className:"w-full text-sm",children:n.map(a=>e.jsx("li",{className:"w-full",children:e.jsx(St,{task:a})},a.issue_number))})]})}class Et{static async getSuggestedTasks(){const{data:n}=await He.get("/api/user/suggested-tasks");return n}}function Rt(t){const n={};for(const s of t){const a=`${s.repo}`;n[a]||(n[a]={title:a,tasks:[]}),n[a].tasks.push(s)}return Object.values(n)}const _t=()=>{const t=Ye();return Ne({queryKey:["tasks"],queryFn:Et.getSuggestedTasks,select:Rt,enabled:t})};function Mt(){return e.jsxs("li",{className:"py-3 flex items-center pr-6",children:[e.jsx("div",{className:"h-3 w-8 skeleton !rounded-sm"}),e.jsxs("div",{className:"w-full pl-8",children:[e.jsx("div",{className:"h-3 w-24 skeleton mb-2 !rounded-sm"}),e.jsx("div",{className:T("h-3 skeleton w-3/4 !rounded-sm")})]}),e.jsx("div",{className:"h-3 w-16 skeleton !rounded-sm"})]})}function Ot({items:t=3}){return e.jsxs("div",{"data-testid":"task-group-skeleton",children:[e.jsx("div",{className:"py-3 border-b border-[#717888] pt-3.5",children:e.jsx("div",{className:"h-3 w-40 skeleton !rounded-sm"})}),e.jsx("ul",{children:Array.from({length:t}).map((n,s)=>e.jsx(Mt,{},s))}),e.jsx("div",{className:"w-15 h-3 skeleton !rounded-sm mb-4"})]})}function yt(){return e.jsx(Ot,{})}function Tt({filterFor:t}){const{t:n}=P(),[s,a]=r.useState(!1),{data:l,isLoading:d}=_t(),c=t?l?.filter(x=>x.title===t.full_name&&!!x.tasks.find(N=>N.git_provider===t.git_provider)):l,i=c&&c.length>0,o=Ge(c,s),m=Ue(c)>3,u=()=>{a(x=>!x)};return e.jsxs("section",{"data-testid":"task-suggestions",className:"flex flex-1 min-w-0 flex-col",children:[e.jsx("div",{className:T("flex items-center gap-2",!i&&"mb-[14px]"),children:e.jsx("h3",{className:"text-xs leading-4 text-white font-semibold py-[14px] pl-[14px]",children:n(S.TASKS$SUGGESTED_TASKS)})}),e.jsxs("div",{className:"flex flex-col",children:[d&&e.jsx("div",{className:"px-[14px]",children:e.jsx(yt,{})}),!i&&!d&&e.jsx("span",{className:"text-xs leading-4 text-white font-medium px-[14px]",children:n(S.TASKS$NO_TASKS_AVAILABLE)}),!d&&o&&o.length>0&&e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{className:"transition-all duration-300 ease-in-out overflow-y-auto custom-scrollbar",children:e.jsx("div",{className:"flex flex-col",children:o.map((x,N)=>e.jsx(wt,{title:decodeURIComponent(x.title),tasks:x.tasks},N))})})})]}),!d&&m&&e.jsx("div",{className:"flex justify-start mt-6 mb-8 ml-[14px]",children:e.jsx("button",{type:"button",onClick:u,className:"text-xs leading-4 text-[#FAFAFA] font-normal cursor-pointer hover:underline",children:n(s?S.COMMON$VIEW_LESS:S.COMMON$VIEW_MORE)})})]})}const ie=be("flex items-center",{variants:{gap:{default:"gap-[10px]"},textSize:{default:"text-base"},fontWeight:{default:"font-bold"},textColor:{default:"text-white"},lineHeight:{default:"leading-5"}},defaultVariants:{gap:"default",textSize:"default",fontWeight:"default",textColor:"default",lineHeight:"default"}});function It({icon:t,children:n,className:s="",gap:a,textSize:l,fontWeight:d,textColor:c,lineHeight:i}){return e.jsxs("div",{className:T(ie({gap:a,textSize:l,fontWeight:d,textColor:c,lineHeight:i}),s),children:[t,e.jsx("span",{className:T(ie({lineHeight:i,textSize:l,fontWeight:d,textColor:c}),"flex items-center"),children:n})]})}function Pt(){const{t}=P(),n=Y(),{mutate:s,isPending:a,isSuccess:l}=ee(),d=se(),c=a||l||d,i=()=>{s({},{onSuccess:o=>n(`/conversations/${o.conversation_id}`)})};return e.jsxs(J,{testId:"launch-new-conversation-button",variant:"primary",type:"button",onClick:i,isDisabled:c,className:"w-auto absolute bottom-5 left-5 right-5 font-semibold",children:[!c&&t("COMMON$NEW_CONVERSATION"),c&&t("HOME$LOADING")]})}const kt=be("w-full flex flex-col rounded-[12px] p-[20px] border border-[#727987] bg-[#26282D] relative",{variants:{gap:{default:"gap-[10px]",large:"gap-6"},minHeight:{default:"min-h-[286px] md:min-h-auto",small:"min-h-[263.5px]"}},defaultVariants:{gap:"default",minHeight:"default"}});function At({children:t,className:n="",testId:s,gap:a,minHeight:l}){return e.jsx("div",{"data-testid":s,className:T(kt({gap:a,minHeight:l}),n),children:t})}function Lt(){const{t}=P();return e.jsxs(At,{children:[e.jsx(It,{icon:e.jsx(Qe,{width:17,height:14}),children:t(S.COMMON$START_FROM_SCRATCH)}),e.jsx(Q.Text,{children:t(S.HOME$NEW_PROJECT_DESCRIPTION)}),e.jsx(Pt,{})]})}function Ht(){return e.jsxs("div",{className:"flex flex-col gap-1 py-[14px]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full skeleton"}),e.jsx("div",{className:"w-27 h-3 skeleton !rounded-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 skeleton !rounded-sm"}),e.jsx("div",{className:"w-30.75 max-w-30.75 h-3 skeleton !rounded-sm"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 skeleton !rounded-sm"}),e.jsx("div",{className:"w-24 max-w-24 h-3 skeleton !rounded-sm"})]})]}),e.jsx("div",{className:"w-10 h-3 skeleton !rounded-sm"})]})]})}function Dt({items:t=3}){return e.jsxs("div",{"data-testid":"recent-conversations-skeleton",children:[e.jsx("ul",{children:Array.from({length:t}).map((n,s)=>e.jsx(Ht,{},s))}),e.jsx("div",{className:"w-15 h-3 skeleton !rounded-sm"})]})}function $t(){return e.jsx(Dt,{})}function Vt({conversation:t}){const{t:n}=P(),s=t.selected_repository&&t.selected_branch;return e.jsx(oe,{to:`/conversations/${t.conversation_id}`,children:e.jsxs("button",{type:"button",className:"flex flex-col gap-1 p-[14px] cursor-pointer w-full rounded-lg hover:bg-[#5C5D62] transition-all duration-300 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2 pl-1",children:[e.jsx(Je,{conversationStatus:t.status}),e.jsx("span",{className:"text-xs text-white leading-6 font-normal",children:t.title})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-[#A3A3A3] leading-4 font-normal",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{gitProvider:t.git_provider}),e.jsx("span",{className:"max-w-[124px] truncate",title:t.selected_repository||"",children:t.selected_repository})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{width:12,height:12,color:"#A3A3A3"}),e.jsx("span",{className:"max-w-[124px] truncate",children:n(S.COMMON$NO_REPOSITORY)})]}),s?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(je,{width:12,height:12,color:"#A3A3A3"}),e.jsx("span",{className:"max-w-[124px] truncate",title:t.selected_branch||"",children:t.selected_branch})]}):null]}),e.jsxs("span",{children:[Xe(new Date(t.created_at||t.last_updated_at))," ",n(S.CONVERSATION$AGO)]})]})]})})}function Gt(){const{t}=P(),[n,s]=r.useState(!1),{data:a,isFetching:l,isFetchingNextPage:d,error:c,hasNextPage:i,fetchNextPage:o}=et(10),m=tt({hasNextPage:!!i,isFetchingNextPage:d,fetchNextPage:o,threshold:200}),u=a?.pages.flatMap(b=>b.results)??[],x=n?10:3,N=u.slice(0,x),w=u&&u.length>0,f=u&&u.length>x,g=l&&!a,h=()=>{s(!n)};return e.jsxs("section",{"data-testid":"recent-conversations",className:"flex flex-1 min-w-0 flex-col",children:[e.jsx("div",{className:T("flex items-center gap-2",!w&&"mb-[14px]"),children:e.jsx("h3",{className:"text-xs leading-4 text-white font-bold py-[14px] pl-4",children:t(S.COMMON$RECENT_CONVERSATIONS)})}),c&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full pl-4",children:e.jsx("p",{className:"text-danger",children:c.message})}),e.jsx("div",{className:"flex flex-col",children:g&&e.jsx("div",{className:"pl-4",children:e.jsx($t,{})})}),!g&&N?.length===0&&e.jsx("span",{className:"text-xs leading-4 text-white font-medium pl-4",children:t(S.HOME$NO_RECENT_CONVERSATIONS)}),!g&&N&&N.length>0&&e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{className:"transition-all duration-300 ease-in-out overflow-y-auto custom-scrollbar",children:e.jsx("div",{ref:m,className:"flex flex-col",children:N.map(b=>e.jsx(Vt,{conversation:b},b.conversation_id))})})}),!g&&(f||n)&&e.jsx("div",{className:"flex justify-start mt-6 mb-8 ml-4",children:e.jsx("button",{type:"button",onClick:h,className:"text-xs leading-4 text-[#FAFAFA] font-normal cursor-pointer hover:underline",children:t(n?S.COMMON$VIEW_LESS:S.COMMON$VIEW_MORE)})})]})}function Ut(){const[t,n]=H.useState(null);return e.jsxs("div",{"data-testid":"home-screen",className:"px-0 pt-4 bg-transparent h-full flex flex-col pt-[35px] overflow-y-auto rounded-xl lg:px-[42px] lg:pt-[42px] custom-scrollbar-always",children:[e.jsx(rt,{}),e.jsx("div",{className:"pt-[25px] flex justify-center",children:e.jsxs("div",{className:"flex flex-col gap-5 px-6 sm:max-w-full sm:min-w-full md:flex-row lg:px-0 lg:max-w-[703px] lg:min-w-[703px]","data-testid":"home-screen-new-conversation-section",children:[e.jsx(jt,{onRepoSelection:s=>n(s)}),e.jsx(Lt,{})]})}),e.jsx("div",{className:"pt-4 flex sm:justify-start md:justify-center",children:e.jsxs("div",{className:"flex flex-col gap-5 px-6 md:flex-row min-w-full md:max-w-full lg:px-0 lg:max-w-[703px] lg:min-w-[703px]","data-testid":"home-screen-recent-conversations-section",children:[e.jsx(Gt,{}),e.jsx(Tt,{filterFor:t})]})})]})}const fs=ye(Ut);export{fs as default};
