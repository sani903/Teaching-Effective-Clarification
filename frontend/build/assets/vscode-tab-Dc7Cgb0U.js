import{R as _,r as x,p as s}from"./chunk-NISHYRIK-CgksP-ke.js";import{I as n}from"./declaration-BLNM_M5s.js";import{b as y,u as I,R}from"./parse-pr-url-CCSuKL2A.js";import{a as C}from"./use-config-BtaDlBUv.js";import{V as A,C as N,c as V}from"./feature-flags-1f3MRGYs.js";import{t as v}from"./index-JS6LK1M2.js";import{u as g,a as L,W as O}from"./conversation-BJC1AsS5.js";import{u as b}from"./use-batch-sandboxes-BSkeku7q.js";import{u as S}from"./useTranslation-BhtO8iYN.js";import"./open-hands-axios-DsgPCc-0.js";import"./gestures-BcGXZsOZ.js";import"./index-BBSevn_K.js";import"./utils-C5iw9p3M.js";import"./module-CWLbpm_7.js";import"./index-DJ6Yt2gU.js";import"./optimistic-user-message-store-BLUkFBLR.js";import"./brand-button-BLaTuvKj.js";import"./index-CQq-b-9n.js";import"./query-client-config-D_0Qd0_c.js";import"./i18next-Lgj2Bm8L.js";import"./retrieve-axios-error-message-CYr77e_f.js";import"./custom-toast-handlers-B_1yfMGT.js";import"./option-service.api-L97_35Hu.js";import"./infiniteQueryBehavior-D4OZgA3F.js";import"./use-user-providers-CPbKIWnc.js";import"./use-settings-y2Eq7ITW.js";import"./use-is-authed-CJdzFdqm.js";import"./close-_PwA9ZeD.js";import"./index-DastLBCt.js";import"./useSingleSelectListState-D8PQAT0i.js";import"./preload-helper-BhQ1_4_d.js";import"./index-0urWFDHv.js";import"./base-modal-LOTJhsuL.js";import"./modal-body-DfkwqNDR.js";import"./modal-backdrop-CfHRd2ER.js";import"./tooltip-button-CGDIzzom.js";import"./middleware-BNIo_uWn.js";import"./typography-DvyHXuI5.js";import"./repo-forked-Bc3iCQ5X.js";import"./index-Cfwn16jo.js";import"./Trans-CSq1Url9.js";import"./settings-dropdown-input-DCArA_yj.js";import"./optional-tag-C2att6n-.js";import"./chunk-S6H5EOGR-BBckzTk7.js";import"./loading-spinner-CE6B7tvy.js";const w=t=>C({queryKey:["v1-batch-get-app-conversations",t],queryFn:()=>A.batchGetAppConversations(t),enabled:t.length>0,staleTime:1e3*60*5,gcTime:1e3*60*15}),T=()=>{const{t}=S(),{conversationId:r}=y(),{data:p}=I(),l=g(),i=p?.conversation_version==="V1",c=w(i&&r?[r]:[]),a=c.data?.[0]?.sandbox_id,o=b(a?[a]:[]),e=C({queryKey:["unified","vscode_url",r,i,a],queryFn:async()=>{if(!r)throw new Error("No conversation ID");if(i){if(!o.data||o.data.length===0||!o.data[0])return{url:null,error:t(n.VSCODE$URL_NOT_AVAILABLE)};const m=o.data[0].exposed_urls?.find(h=>h.name==="VSCODE");return m?{url:v(m.url),error:null}:{url:null,error:t(n.VSCODE$URL_NOT_AVAILABLE)}}const u=await N.getVSCodeUrl(r);return u.vscode_url?{url:v(u.vscode_url),error:null}:{url:null,error:t(n.VSCODE$URL_NOT_AVAILABLE)}},enabled:l&&!!r&&(!i||!!o.data),refetchOnMount:!0,retry:3}),d=i&&(c.isLoading||o.isLoading)||e.isLoading;return{data:e.data,error:e.error,isLoading:d,isError:e.isError,isSuccess:e.isSuccess,status:e.status,refetch:e.refetch}};function Ar(){const{t}=S(),{data:r,isLoading:p,error:l}=T(),{curAgentState:i}=L(),c=R.includes(i),E=_.useRef(null),[a,o]=x.useState(!1),[e,d]=x.useState(null);x.useEffect(()=>{if(r?.url)try{const f=new URL(r.url).protocol,m=window.location.protocol;o(V()||f!==m)}catch{d(t("VSCODE$URL_PARSE_ERROR"))}},[r?.url]);const u=()=>{r?.url&&window.open(r.url,"_blank","noopener,noreferrer")};return c?s.jsx(O,{}):p?s.jsx("div",{className:"w-full h-full flex items-center text-center justify-center text-2xl text-tertiary-light",children:t(n.VSCODE$LOADING)}):l||r&&r.error||!r?.url||e?s.jsx("div",{className:"w-full h-full flex items-center text-center justify-center text-2xl text-tertiary-light",children:e||r?.error||String(l)||t(n.VSCODE$URL_NOT_AVAILABLE)}):a?s.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center gap-4",children:[s.jsx("div",{className:"text-xl text-tertiary-light text-center max-w-md",children:t("VSCODE$CROSS_ORIGIN_WARNING")}),s.jsx("button",{type:"button",onClick:u,className:"px-4 py-2 bg-primary text-white rounded-sm hover:bg-primary-dark transition-colors",children:t("VSCODE$OPEN_IN_NEW_TAB")})]}):s.jsx("div",{className:"h-full w-full",children:s.jsx("iframe",{ref:E,title:t(n.VSCODE$TITLE),src:r.url,className:"w-full h-full border-0",allow:"clipboard-read; clipboard-write"})})}export{Ar as default};
