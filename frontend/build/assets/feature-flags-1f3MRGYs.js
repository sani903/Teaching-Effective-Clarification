import{A as g,o as n,a as d}from"./open-hands-axios-DsgPCc-0.js";import{r as l}from"./utils-C5iw9p3M.js";class y{static currentConversation=null;static getCurrentConversation(){return this.currentConversation}static setCurrentConversation(t){this.currentConversation=t}static getConversationUrl(t){return this.currentConversation?.conversation_id===t&&this.currentConversation.url?this.currentConversation.url:`/api/conversations/${t}`}static getConversationHeaders(){const t=new g,a=this.currentConversation?.session_api_key;return a&&t.set("X-Session-API-Key",a),t}static async submitFeedback(t,a){const s=`/api/conversations/${t}/submit-feedback`,{data:e}=await n.post(s,a);return e}static async submitConversationFeedback(t,a,s,e){const r="/feedback/conversation",o={conversation_id:t,event_id:s,rating:a,reason:e,metadata:{source:"likert-scale"}},{data:c}=await n.post(r,o);return c}static async checkFeedbackExists(t,a){try{const s=`/feedback/conversation/${t}/${a}`,{data:e}=await n.get(s);return e}catch{return{exists:!1}}}static async getBatchFeedback(t){const a=`/feedback/conversation/${t}/batch`,{data:s}=await n.get(a);return s}static async getWebHosts(t){const a=`${this.getConversationUrl(t)}/web-hosts`,s=await n.get(a,{headers:this.getConversationHeaders()});return Object.keys(s.data.hosts)}static async getVSCodeUrl(t){const a=`${this.getConversationUrl(t)}/vscode-url`,{data:s}=await n.get(a,{headers:this.getConversationHeaders()});return s}static async getRuntimeId(t){const a=`${this.getConversationUrl(t)}/config`,{data:s}=await n.get(a,{headers:this.getConversationHeaders()});return s}static async getUserConversations(t=20,a){const s=new URLSearchParams;s.append("limit",t.toString()),a&&s.append("page_id",a);const{data:e}=await n.get(`/api/conversations?${s.toString()}`);return e}static async searchConversations(t,a,s=100){const e=new URLSearchParams;e.append("limit",s.toString()),t&&e.append("selected_repository",t),a&&e.append("conversation_trigger",a);const{data:r}=await n.get(`/api/conversations?${e.toString()}`);return r.results}static async deleteUserConversation(t){await n.delete(`/api/conversations/${t}`)}static async createConversation(t,a,s,e,r,o,c){const u={repository:t,git_provider:a,selected_branch:r,initial_user_msg:s,suggested_task:e,conversation_instructions:o,create_microagent:c},{data:p}=await n.post("/api/conversations",u);return p}static async getConversation(t){const{data:a}=await n.get(`/api/conversations/${t}`);return a}static async startConversation(t,a){const{data:s}=await n.post(`/api/conversations/${t}/start`,a?{providers_set:a}:{});return s}static async stopConversation(t){const{data:a}=await n.post(`/api/conversations/${t}/stop`);return a}static async getTrajectory(t){const a=`${this.getConversationUrl(t)}/trajectory`,{data:s}=await n.get(a,{headers:this.getConversationHeaders()});return s}static async getMicroagents(t){const a=`${this.getConversationUrl(t)}/microagents`,{data:s}=await n.get(a,{headers:this.getConversationHeaders()});return s}static async getMicroagentPrompt(t,a){const s=`${this.getConversationUrl(t)}/remember-prompt`,{data:e}=await n.get(s,{params:{event_id:a},headers:this.getConversationHeaders()});return e.prompt}static async updateConversation(t,a){const{data:s}=await n.patch(`/api/conversations/${t}`,a);return s}static async getFiles(t,a){const s=`${this.getConversationUrl(t)}/list-files`,{data:e}=await n.get(s,{params:{path:a},headers:this.getConversationHeaders()});return e}static async uploadFiles(t,a){const s=new FormData;for(const o of a)s.append("files",o);const e=`${this.getConversationUrl(t)}/upload-files`;return(await n.post(e,s,{headers:{"Content-Type":"multipart/form-data",...this.getConversationHeaders()}})).data}}function v(i){if(i&&!i.startsWith("/"))try{return new URL(i).host}catch{return window.location.host}return window.location.host}function w(i){const t=v(i);return`${window.location.protocol==="https:"?"https:":"http:"}//${t}`}function b(i,t){if(!i)return null;const a=v(t);return`${window.location.protocol==="https:"?"wss:":"ws:"}//${a}/sockets/events/${i}`}class ${static buildRuntimeUrl(t,a){return`${w(t)}${a}`}static async sendMessage(t,a){const{data:s}=await n.post(`/api/conversations/${t}/events`,a);return s}static async createConversation(t,a,s,e,r,o){const c={selected_repository:t,git_provider:a,selected_branch:e,title:r,trigger:o};s&&(c.initial_message={role:"user",content:[{type:"text",text:s}]});const{data:u}=await n.post("/api/v1/app-conversations",c);return u}static async getStartTask(t){const{data:a}=await n.get(`/api/v1/app-conversations/start-tasks?ids=${t}`);return a[0]||null}static async searchStartTasks(t=100){const a=new URLSearchParams;a.append("limit",t.toString());const{data:s}=await n.get(`/api/v1/app-conversations/start-tasks/search?${a.toString()}`);return s.items}static async getVSCodeUrl(t,a,s){const e=this.buildRuntimeUrl(a,"/api/vscode/url"),r=l(s),{data:o}=await d.get(e,{headers:r});return{vscode_url:o.url}}static async pauseConversation(t,a,s){const e=this.buildRuntimeUrl(a,`/api/conversations/${t}/pause`),r=l(s),{data:o}=await d.post(e,{},{headers:r});return o}static async resumeConversation(t,a,s){const e=this.buildRuntimeUrl(a,`/api/conversations/${t}/run`),r=l(s),{data:o}=await d.post(e,{},{headers:r});return o}static async pauseSandbox(t){const{data:a}=await n.post(`/api/v1/sandboxes/${t}/pause`,{});return a}static async resumeSandbox(t){const{data:a}=await n.post(`/api/v1/sandboxes/${t}/resume`,{});return a}static async batchGetAppConversations(t){if(t.length===0)return[];if(t.length>100)throw new Error("Cannot request more than 100 conversations at once");const a=new URLSearchParams;t.forEach(e=>a.append("ids",e));const{data:s}=await n.get(`/api/v1/app-conversations?${a.toString()}`);return s}static async batchGetSandboxes(t){if(t.length===0)return[];if(t.length>100)throw new Error("Cannot request more than 100 sandboxes at once");const a=new URLSearchParams;t.forEach(e=>a.append("id",e));const{data:s}=await n.get(`/api/v1/sandboxes?${a.toString()}`);return s}static async uploadFile(t,a,s,e){const r=e||`/workspace/${s.name}`,o=encodeURIComponent(r),c=this.buildRuntimeUrl(t,`/api/file/upload/${o}`),u=l(a),p=new FormData;p.append("file",s),await d.post(c,p,{headers:{...u,"Content-Type":"multipart/form-data"}})}static async getConversationConfig(t){const a=`/api/conversations/${t}/config`,{data:s}=await n.get(a);return s}static async getEventCount(t){const a=new URLSearchParams;a.append("conversation_id__eq",t);const{data:s}=await n.get(`/api/v1/events/count?${a.toString()}`);return s}}function h(i,t=!1){try{const a=localStorage.getItem(`FEATURE_${i}`)||t.toString();return!!JSON.parse(a)}catch{return t}}const f=()=>h("VSCODE_IN_NEW_TAB"),S=()=>h("USE_V1_CONVERSATION_API");export{y as C,S as U,$ as V,w as a,b,f as c};
