import{R as f,r as u,p as e,t as Te,v as j,x as be,y as W,z as ee,A as Me,w as Le,O as Re,B as ye,i as De}from"./chunk-NISHYRIK-CgksP-ke.js";import{I as i}from"./declaration-BLNM_M5s.js";import"./index-Cfwn16jo.js";import{u as K}from"./use-is-authed-CJdzFdqm.js";import{u as b,a as ie,b as Pe}from"./use-config-BtaDlBUv.js";import{D as Z}from"./module-CWLbpm_7.js";import{o as Ue}from"./open-hands-axios-DsgPCc-0.js";import{u as re,S as ke,C as $e,f as le,a as Be,b as Ge}from"./format-time-delta-XCy4G5Sb.js";import{L as H}from"./loading-spinner-CE6B7tvy.js";import{c as S,S as te,i as se,a as Ve}from"./utils-C5iw9p3M.js";import{u as g}from"./useTranslation-BhtO8iYN.js";import{u as X,C as ce,a as I,D as de,S as Fe,b as ue,c as R,d as He,e as We,f as Ye,g as ze,h as Ke,i as Ze,j as Xe,t as qe,k as Je,l as Qe,m as et,n as tt,o as st,p as nt}from"./index-JS6LK1M2.js";import{S as at,O as ot}from"./settings-nav-BzeErX2Q.js";import{S as Y}from"./openhands-logo-B-HZ0Q7q.js";import{T as z}from"./tooltip-button-CGDIzzom.js";import{M as it,o as rt,H as me,u as lt}from"./model-selector-BRqT5jIE.js";import{M as U}from"./modal-backdrop-CfHRd2ER.js";import{B as ct,a as he,M as ne,b as dt}from"./base-modal-LOTJhsuL.js";import{e as ut}from"./settings-utils-DdSYLo-D.js";import{B as D,u as mt}from"./brand-button-BLaTuvKj.js";import{S as ht}from"./settings-input-Blv1eH9r.js";import{u as q}from"./use-save-settings-C2NDO2vm.js";import{D as ft,u as J}from"./use-settings-y2Eq7ITW.js";import{U as xt,V as pt,C as gt}from"./feature-flags-1f3MRGYs.js";import{M as V}from"./modal-body-DfkwqNDR.js";import{a as fe,d as xe}from"./custom-toast-handlers-B_1yfMGT.js";import{F as Ct,a as Et}from"./index-DastLBCt.js";import{F as Nt,a as vt,b as St,c as _t,d as At}from"./index-CQq-b-9n.js";import{S as wt}from"./repo-forked-Bc3iCQ5X.js";import{R as It}from"./preload-helper-BhQ1_4_d.js";import{u as jt,g as pe,L as P,s as Ot,a as ae}from"./use-logout-CiIaaofq.js";import{h as ge}from"./handle-capture-consent-DZaBHqCI.js";import{B as Tt,u as bt}from"./use-balance-wP8ARcPg.js";import{T as Mt}from"./Trans-CSq1Url9.js";import{S as Lt}from"./close-_PwA9ZeD.js";import{i as Rt}from"./i18next-Lgj2Bm8L.js";import"./option-service.api-L97_35Hu.js";import"./use-user-providers-CPbKIWnc.js";import"./useInfiniteQuery-DoKcZZP5.js";import"./infiniteQueryBehavior-D4OZgA3F.js";import"./index-0urWFDHv.js";import"./index-DJ6Yt2gU.js";import"./server-process-BvykxQDk.js";import"./index-BBSevn_K.js";import"./chunk-S6H5EOGR-BBckzTk7.js";import"./useSingleSelectListState-D8PQAT0i.js";import"./optional-tag-C2att6n-.js";const yt=(t,s,n)=>{const o=`${s.hostname==="localhost"?s.protocol:"https:"}//${s.host}/oauth/keycloak/callback`;let r;n?r=`https://${n.replace(/^https?:\/\//,"")}`:(r=s.hostname.replace(/(^|\.)staging\.all-hands\.dev$/,"$1auth.staging.all-hands.dev").replace(/(^|\.)app\.all-hands\.dev$/,"auth.app.all-hands.dev").replace(/(^|\.)localhost$/,"auth.staging.all-hands.dev"),r===s.hostname&&s.hostname!=="localhost"&&(r=`auth.${s.hostname}`),r=`https://${r}`);const d="openid email profile",x=s.search?"&":"?",c=`${s.href.replace(/\/$/,"")}${x}login_method=${t}`;return`${r}/realms/allhands/protocol/openid-connect/auth?client_id=allhands&kc_idp_hint=${t}&response_type=code&redirect_uri=${encodeURIComponent(o)}&scope=${encodeURIComponent(d)}&state=${encodeURIComponent(c)}`},T=t=>t.appMode==="saas"?yt(t.identityProvider,new URL(window.location.href),t.authUrl):null,Dt=t=>T({appMode:t.appMode,identityProvider:"github",authUrl:t.authUrl});class Pt{static async getUser(){const s=await Ue.get("/api/user/info"),{data:n}=s;return{id:n.id,login:n.login,avatar_url:n.avatar_url,company:n.company,name:n.name,email:n.email}}}const Ce=()=>{const{data:t}=b(),s=re(),n=ie({queryKey:["user"],queryFn:Pt.getUser,enabled:s,retry:!1,staleTime:1e3*60*5,gcTime:1e3*60*15});return f.useEffect(()=>{n.data&&Z.identify(n.data.login,{company:n.data.company,name:n.data.name,email:n.data.email,user:n.data.login,mode:t?.APP_MODE||"oss"})},[n.data]),n},Ut=t=>u.createElement("svg",{width:27,height:26,viewBox:"0 0 27 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},u.createElement("g",{clipPath:"url(#clip0_40000158_426)"},u.createElement("path",{d:"M13.5381 1.83496C7.32618 1.83496 2.29074 6.8704 2.29074 13.0823C2.29074 19.2942 7.32618 24.3297 13.5381 24.3297C19.75 24.3297 24.7855 19.2942 24.7855 13.0823C24.7855 6.8704 19.75 1.83496 13.5381 1.83496Z",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"}),u.createElement("path",{d:"M4.84641 20.22C4.84641 20.22 7.35344 17.019 13.5395 17.019C19.7255 17.019 22.2337 20.22 22.2337 20.22M13.5395 13.0824C14.4344 13.0824 15.2926 12.7269 15.9254 12.0941C16.5582 11.4613 16.9137 10.6031 16.9137 9.70819C16.9137 8.8133 16.5582 7.95505 15.9254 7.32227C15.2926 6.68948 14.4344 6.33398 13.5395 6.33398C12.6446 6.33398 11.7863 6.68948 11.1536 7.32227C10.5208 7.95505 10.1653 8.8133 10.1653 9.70819C10.1653 10.6031 10.5208 11.4613 11.1536 12.0941C11.7863 12.7269 12.6446 13.0824 13.5395 13.0824Z",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"})),u.createElement("defs",null,u.createElement("clipPath",{id:"clip0_40000158_426"},u.createElement("rect",{width:26,height:26,fill:"white",transform:"translate(0.5)"}))));function kt({src:t}){const{t:s}=g();return e.jsx("img",{src:t,alt:s(i.AVATAR$ALT_TEXT),className:"w-full h-full rounded-full"})}function $t({onClick:t,avatarUrl:s,isLoading:n}){const{t:a}=g();return e.jsxs("button",{type:"button","data-testid":"user-avatar",className:S("w-8 h-8 rounded-full flex items-center justify-center cursor-pointer",n&&"bg-transparent"),onClick:t,children:[!n&&s&&e.jsx(kt,{src:s}),!n&&!s&&e.jsx(Ut,{"aria-label":a(i.USER$AVATAR_PLACEHOLDER),width:28,height:28,className:"text-[#9099AC]"}),n&&e.jsx(H,{size:"small"})]})}const Bt=t=>u.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",...t},u.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 20C11 19.4477 10.5523 19 10 19H5V5H10C10.5523 5 11 4.55228 11 4C11 3.44771 10.5523 3 10 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H10C10.5523 21 11 20.5523 11 20Z",fill:"currentColor"}),u.createElement("path",{d:"M21.7136 12.7005C21.8063 12.6062 21.8764 12.498 21.9241 12.3828C21.9727 12.2657 21.9996 12.1375 22 12.003L22 12L22 11.997C21.9992 11.7421 21.9016 11.4874 21.7071 11.2929L17.7071 7.29289C17.3166 6.90237 16.6834 6.90237 16.2929 7.29289C15.9024 7.68342 15.9024 8.31658 16.2929 8.70711L18.5858 11H9C8.44771 11 8 11.4477 8 12C8 12.5523 8.44771 13 9 13H18.5858L16.2929 15.2929C15.9024 15.6834 15.9024 16.3166 16.2929 16.7071C16.6834 17.0976 17.3166 17.0976 17.7071 16.7071L21.7064 12.7078L21.7136 12.7005Z",fill:"currentColor"}));function Gt({onLogout:t,onClose:s}){const n=X(s),{t:a}=g(),{data:o}=b(),d=(o?.APP_MODE==="saas"?at:ot).map(l=>({...l,icon:f.cloneElement(l.icon,{width:16,height:16})})),x=()=>{s()};return e.jsxs(ce,{testId:"account-settings-context-menu",ref:n,alignment:"right",className:"mt-0 md:right-full md:left-full md:bottom-0 ml-0 w-fit z-[9999]",children:[d.map(({to:l,text:c,icon:h})=>e.jsx(Te,{to:l,className:"text-decoration-none",children:e.jsxs(I,{onClick:()=>x(),className:"flex items-center gap-2 p-2 hover:bg-[#5C5D62] rounded h-[30px]",children:[h,e.jsx("span",{className:"text-white text-sm",children:a(c)})]})},l)),e.jsx(de,{}),e.jsxs(I,{onClick:t,className:"flex items-center gap-2 p-2 hover:bg-[#5C5D62] rounded h-[30px]",children:[e.jsx(Bt,{width:16,height:16}),e.jsx("span",{className:"text-white text-sm",children:a(i.ACCOUNT_SETTINGS$LOGOUT)})]})]})}function Vt({onLogout:t,user:s,isLoading:n}){const[a,o]=f.useState(!1),{data:r}=b(),d=re(),x=()=>{o(v=>!v)},l=()=>{a&&o(!1)},c=()=>{t(),l()},h=r?.APP_MODE==="oss",p=a&&(d||h);return e.jsxs("div",{"data-testid":"user-actions",className:"w-8 h-8 relative cursor-pointer group",children:[e.jsx($t,{avatarUrl:s?.avatar_url,onClick:x,isLoading:n}),(d||h)&&e.jsx("div",{className:S("opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto",p&&"opacity-100 pointer-events-auto"),children:e.jsx(Gt,{onLogout:c,onClose:l})})]})}function Ft(){const{t}=g();return e.jsx(z,{tooltip:t(i.BRANDING$OPENHANDS),ariaLabel:t(i.BRANDING$OPENHANDS_LOGO),navLinkTo:"/",children:e.jsx(Y,{width:46,height:30})})}function Ht({disabled:t=!1}){const{pathname:s}=j(),{t:n}=g(),a=n(i.CONVERSATION$START_NEW);return e.jsx(z,{tooltip:a,ariaLabel:a,navLinkTo:"/",testId:"new-project-button",disabled:t,children:e.jsx(ke,{width:24,height:24,color:s==="/"?"#ffffff":"#B1B9D3"})})}const Wt=t=>u.createElement("svg",{width:25,height:20,viewBox:"0 0 25 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},u.createElement("path",{d:"M23 2L8 2",stroke:"currentColor",strokeWidth:2.5,strokeLinecap:"round"}),u.createElement("path",{d:"M2.72656 2H1.99929",stroke:"currentColor",strokeWidth:2.5,strokeLinecap:"round"}),u.createElement("path",{d:"M2.72656 10H1.99929",stroke:"currentColor",strokeWidth:2.5,strokeLinecap:"round"}),u.createElement("path",{d:"M2.72656 18H1.99929",stroke:"currentColor",strokeWidth:2.5,strokeLinecap:"round"}),u.createElement("path",{d:"M23 10L8 10",stroke:"currentColor",strokeWidth:2.5,strokeLinecap:"round"}),u.createElement("path",{d:"M23 18H8",stroke:"currentColor",strokeWidth:2.5,strokeLinecap:"round"}));function Yt({isOpen:t,onClick:s,disabled:n=!1}){const{t:a}=g();return e.jsx(z,{testId:"toggle-conversation-panel",tooltip:a(i.SIDEBAR$CONVERSATIONS),ariaLabel:a(i.SIDEBAR$CONVERSATIONS),onClick:s,disabled:n,children:e.jsx(Wt,{width:24,height:24,className:S("cursor-pointer",t?"text-white":"text-[#B1B9D3]",n&&"opacity-50")})})}function zt({testId:t,title:s,description:n,buttons:a}){return e.jsx(ct,{testId:t,title:s,description:n,buttons:[{text:a.danger.text,onClick:a.danger.onClick,className:"bg-danger"},{text:a.cancel.text,onClick:a.cancel.onClick,className:"bg-neutral-500"}]})}function Kt({settings:t,models:s,onClose:n}){const{mutate:a}=q(),o=j(),{t:r}=g(),d=f.useRef(null),[x,l]=f.useState(!1),c=async C=>{const E=ut(C);await a(E,{onSuccess:()=>{n(),Z.capture("settings_saved",{LLM_MODEL:E.LLM_MODEL,LLM_API_KEY_SET:E.LLM_API_KEY_SET?"SET":"UNSET",SEARCH_API_KEY_SET:E.SEARCH_API_KEY?"SET":"UNSET",REMOTE_RUNTIME_RESOURCE_FACTOR:E.REMOTE_RUNTIME_RESOURCE_FACTOR})}})},h=()=>{const C=new FormData(d.current??void 0);c(C)},p=C=>{C.preventDefault();const E=new FormData(C.currentTarget);o.pathname.startsWith("/conversations/")?l(!0):c(E)},v=t.LLM_API_KEY_SET;return e.jsxs("div",{children:[e.jsxs("form",{ref:d,"data-testid":"settings-form",className:"flex flex-col gap-6",onSubmit:p,children:[e.jsxs("div",{className:"flex flex-col gap-[17px]",children:[e.jsx(it,{models:rt(s),currentModel:t.LLM_MODEL,wrapperClassName:"!flex-col !gap-[17px]",labelClassName:te.LABEL_CLASSNAME}),e.jsx(ht,{testId:"llm-api-key-input",name:"llm-api-key-input",label:r(i.SETTINGS_FORM$API_KEY),type:"password",className:"w-full",placeholder:v?"<hidden>":"",labelClassName:te.LABEL_CLASSNAME}),e.jsx(me,{testId:"llm-api-key-help-anchor",text:r(i.SETTINGS$DONT_KNOW_API_KEY),linkText:r(i.SETTINGS$CLICK_FOR_INSTRUCTIONS),href:"https://docs.all-hands.dev/usage/local-setup#getting-an-api-key",size:"settings",linkColor:"white"})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(D,{testId:"save-settings-button",type:"submit",variant:"primary",className:"w-full font-semibold",children:r(i.BUTTON$SAVE)})})]}),x&&e.jsx(U,{children:e.jsx(zt,{title:r(i.MODAL$END_SESSION_TITLE),description:r(i.MODAL$END_SESSION_MESSAGE),buttons:{danger:{text:r(i.BUTTON$END_SESSION),onClick:h},cancel:{text:r(i.BUTTON$CANCEL),onClick:()=>l(!1)}}})})]})}function Zt({onClose:t,settings:s}){const n=lt(),{t:a}=g();return e.jsx(U,{children:e.jsxs("div",{"data-testid":"ai-config-modal",className:"bg-[#25272D] min-w-full max-w-[475px] m-4 p-6 rounded-xl flex flex-col gap-[17px] border border-tertiary api-configuration-modal",children:[n.error&&e.jsx("p",{className:"text-danger text-xs",children:n.error.message}),e.jsx("span",{className:"text-5 leading-6 font-semibold -tracking-[0.2px]",children:a(i.AI_SETTINGS$TITLE)}),e.jsx(me,{testId:"advanced-settings-link",text:`${a(i.SETTINGS$DESCRIPTION)}. ${a(i.SETTINGS$FOR_OTHER_OPTIONS)} ${a(i.COMMON$SEE)}`,linkText:a(i.COMMON$ADVANCED_SETTINGS),href:"/settings",suffix:".",size:"settings",linkColor:"white",suffixClassName:"text-white"}),n.isLoading&&e.jsx("div",{className:"flex justify-center",children:e.jsx(H,{size:"small"})}),n.data&&e.jsx(Kt,{settings:s||ft,models:n.data?.models,onClose:t})]})})}const Xt=(t=10)=>ie({queryKey:["start-tasks","search",t],queryFn:()=>pt.searchStartTasks(t),enabled:xt(),select:s=>s.filter(n=>n.status!=="READY"&&n.status!=="ERROR")});function qt({onConfirm:t,onClose:s}){const{t:n}=g();return e.jsx(U,{children:e.jsxs(V,{testID:"confirm-new-conversation-modal",children:[e.jsx(he,{title:n(i.CONVERSATION$EXIT_WARNING)}),e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsx(ne,{text:n(i.ACTION$CONFIRM),onClick:t,className:"bg-[#C63143] flex-1"}),e.jsx(ne,{text:n(i.BUTTON$CANCEL),onClick:s,className:"bg-tertiary flex-1"})]})]})})}function Jt({titleMode:t,title:s,onSave:n,isConversationArchived:a}){return t==="edit"?e.jsx("input",{autoFocus:!0,"data-testid":"conversation-card-title",onClick:o=>{o.preventDefault(),o.stopPropagation()},onBlur:o=>{const r=o.currentTarget?.value?.trim?.()??"";n(r)},onKeyUp:o=>{o.key==="Enter"&&o.currentTarget.blur()},type:"text",defaultValue:s,className:"text-sm leading-6 font-semibold bg-transparent w-full"}):e.jsx("p",{"data-testid":"conversation-card-title",className:S("text-xs leading-6 font-semibold bg-transparent truncate overflow-hidden",a&&"opacity-60"),title:s,children:s})}function Qt({conversationStatus:t}){const{t:s}=g();return t==="ARCHIVED"?e.jsxs("span",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-[#868E96] text-white text-xs font-medium rounded-full opacity-60",children:[e.jsx(Ct,{size:10,className:"text-white"}),e.jsx("span",{children:s(i.COMMON$ARCHIVED)})]}):t==="ERROR"?e.jsxs("span",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-[#FF684E] text-white text-xs font-medium rounded-full",children:[e.jsx(Fe,{className:"text-white w-3 h-3"}),e.jsx("span",{children:s(i.COMMON$ERROR)})]}):null}function es({title:t,titleMode:s,onTitleSave:n,conversationStatus:a,conversationVersion:o}){const r=a==="ARCHIVED";return e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0 overflow-hidden mr-2",children:[a&&e.jsx("div",{className:"flex items-center",children:e.jsx($e,{conversationStatus:a})}),e.jsx(ue,{version:o,isConversationArchived:r}),e.jsx(Jt,{title:t,titleMode:s,onSave:n,isConversationArchived:r}),a&&e.jsx(Qt,{conversationStatus:a})]})}const y="cursor-pointer p-0 h-auto hover:bg-transparent";function ts({onClose:t,onDelete:s,onStop:n,onEdit:a,onDisplayCost:o,onShowAgentTools:r,onShowMicroagents:d,onDownloadViaVSCode:x,position:l="bottom"}){const{t:c}=g(),h=X(t),p=u.useCallback((v,C)=>{const E=v.filter(_=>_!=null);return E.length>0?C?E:[...E,e.jsx(de,{},"conversation-card-context-menu-divider")]:[]},[]);return e.jsxs(ce,{ref:h,testId:"context-menu",position:l,alignment:"right",className:"mt-0",children:[p([a&&e.jsx(I,{testId:"edit-button",onClick:a,className:y,children:e.jsx(R,{icon:e.jsx(He,{width:16,height:16}),text:c(i.BUTTON$RENAME)})})]),p([r&&e.jsx(I,{testId:"show-agent-tools-button",onClick:r,className:y,children:e.jsx(R,{icon:e.jsx(We,{width:16,height:16}),text:c(i.BUTTON$SHOW_AGENT_TOOLS_AND_METADATA)})}),d&&e.jsx(I,{testId:"show-microagents-button",onClick:d,className:y,children:e.jsx(R,{icon:e.jsx(Ye,{width:16,height:16}),text:c(i.CONVERSATION$SHOW_MICROAGENTS)})})]),p([n&&e.jsx(I,{testId:"stop-button",onClick:n,className:y,children:e.jsx(R,{icon:e.jsx(ze,{width:16,height:16}),text:c(i.COMMON$CLOSE_CONVERSATION_STOP_RUNTIME)})}),x&&e.jsx(I,{testId:"download-vscode-button",onClick:x,className:y,children:e.jsx(R,{icon:e.jsx(Ke,{width:16,height:16}),text:c(i.BUTTON$DOWNLOAD_VIA_VSCODE)})})]),p([o&&e.jsx(I,{testId:"display-cost-button",onClick:o,className:y,children:e.jsx(R,{icon:e.jsx(Ze,{width:16,height:16}),text:c(i.BUTTON$DISPLAY_COST)})}),s&&e.jsxs(I,{testId:"delete-button",onClick:s,className:y,children:[e.jsx(R,{icon:e.jsx(Xe,{width:16,height:16}),text:c(i.COMMON$DELETE_CONVERSATION)})," "]})],!0)]})}const ss=t=>u.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:2,height:14,viewBox:"0 0 2 14",fill:"none",...t},u.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 14L9.13912e-08 12L2 12L2 14L0 14ZM-2.62268e-07 8L-1.70877e-07 6L2 6L2 8L-2.62268e-07 8ZM-5.24537e-07 2L-4.33146e-07 0L2 -8.74228e-08L2 2L-5.24537e-07 2Z",fill:"white"}));function ns({contextMenuOpen:t,onContextMenuToggle:s,onDelete:n,onStop:a,onEdit:o,onDownloadViaVSCode:r,conversationStatus:d,conversationId:x,showOptions:l}){const c=d==="ARCHIVED";return e.jsxs("div",{className:"group",children:[e.jsx("button",{"data-testid":"ellipsis-button",type:"button",onClick:h=>{h.preventDefault(),h.stopPropagation(),s(!t)},className:S("cursor-pointer w-6 h-6 flex flex-row items-center justify-center translate-x-2.5",c&&"opacity-60"),children:e.jsx(ss,{})}),e.jsx("div",{className:S("relative opacity-0 invisible group-hover:opacity-100 group-hover:visible",t&&"opacity-100 visible"),children:e.jsx(ts,{onClose:()=>s(!1),onDelete:n,onStop:d!=="STOPPED"?a:void 0,onEdit:o,onDownloadViaVSCode:x&&l?r:void 0,position:"bottom"})})]})}const as={bitbucket:_t,github:St,gitlab:vt,enterprise_sso:Nt};function Ee({selectedRepository:t}){const s=t.git_provider?as[t.git_provider]:null;return e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[s&&e.jsx(s,{size:14,className:"text-[#A3A3A3]"}),e.jsx("span",{"data-testid":"conversation-card-selected-repository",className:"text-xs text-[#A3A3A3] whitespace-nowrap overflow-hidden text-ellipsis max-w-44",children:t.selected_repository})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Et,{size:12,className:"text-[#A3A3A3]"}),e.jsx("span",{"data-testid":"conversation-card-selected-branch",className:"text-xs text-[#A3A3A3] whitespace-nowrap overflow-hidden text-ellipsis max-w-24",children:t.selected_branch})]})]})}function Ne(){const{t}=g();return e.jsxs("div",{className:"flex items-center gap-1 text-xs text-[#A3A3A3]",children:[e.jsx(wt,{width:14,height:14,className:"text-[#A3A3A3]"}),e.jsx("span",{children:t(i.COMMON$NO_REPOSITORY)})]})}function os({selectedRepository:t,lastUpdatedAt:s,createdAt:n,conversationStatus:a}){const{t:o}=g(),r=a==="ARCHIVED";return e.jsxs("div",{className:S("flex flex-row justify-between items-center mt-1",r&&"opacity-60"),children:[t?.selected_repository?e.jsx(Ee,{selectedRepository:t}):e.jsx(Ne,{}),(n??s)&&e.jsx("p",{className:"text-xs text-[#A3A3A3] flex-1 text-right",children:e.jsx("time",{children:`${le(new Date(s??n))} ${o(i.CONVERSATION$AGO)}`})})]})}function is({onClick:t,onDelete:s,onStop:n,onChangeTitle:a,showOptions:o,title:r,selectedRepository:d,lastUpdatedAt:x,createdAt:l,conversationId:c,conversationStatus:h,conversationVersion:p,contextMenuOpen:v=!1,onContextMenuToggle:C}){const[E,_]=f.useState("view"),A=N=>{N!==""&&N!==r&&a?.(N),_("view")},k=N=>{N.preventDefault(),N.stopPropagation(),s?.(),C?.(!1)},O=N=>{N.preventDefault(),N.stopPropagation(),n?.(),C?.(!1)},$=N=>{N.preventDefault(),N.stopPropagation(),_("edit"),C?.(!1)},G=async N=>{if(N.preventDefault(),N.stopPropagation(),Z.capture("download_via_vscode_button_clicked"),c)try{const M=await gt.getVSCodeUrl(c);if(M.vscode_url){const B=qe(M.vscode_url);B&&window.open(B,"_blank")}}catch{}C?.(!1)},w=!!(s||a||o);return e.jsxs("div",{"data-testid":"conversation-card","data-context-menu-open":v.toString(),onClick:t,className:S("relative h-auto w-full p-3.5 border-b border-neutral-600 cursor-pointer","data-[context-menu-open=false]:hover:bg-[#454545]"),children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx(es,{title:r,titleMode:E,onTitleSave:A,conversationStatus:h,conversationVersion:p}),w&&e.jsx(ns,{contextMenuOpen:v,onContextMenuToggle:C||(()=>{}),onDelete:s&&k,onStop:n&&O,onEdit:a&&$,onDownloadViaVSCode:G,conversationStatus:h,conversationId:c,showOptions:o})]}),e.jsx(os,{selectedRepository:d,lastUpdatedAt:x,createdAt:l,conversationStatus:h})]})}function rs({taskStatus:t}){const s=()=>{switch(t){case"READY":return"bg-green-500";case"ERROR":return"bg-red-500";case"WORKING":case"WAITING_FOR_SANDBOX":case"PREPARING_REPOSITORY":case"RUNNING_SETUP_SCRIPT":case"SETTING_UP_GIT_HOOKS":case"STARTING_CONVERSATION":return"bg-yellow-500 animate-pulse";default:return"bg-gray-500"}};return e.jsx("div",{className:S("w-2 h-2 rounded-full flex-shrink-0",s()),"aria-label":`Task status: ${t}`})}function ls({taskStatus:t}){if(t==="WORKING")return null;const s=a=>a.toLowerCase().replace(/_/g," ").replace(/\b\w/g,o=>o.toUpperCase()),n=()=>{switch(t){case"READY":return"bg-green-500/10 text-green-400 border-green-500/20";case"ERROR":return"bg-red-500/10 text-red-400 border-red-500/20";default:return"bg-yellow-500/10 text-yellow-400 border-yellow-500/20"}};return e.jsx("span",{className:S("text-xs font-medium px-2 py-0.5 rounded border flex-shrink-0",n()),children:s(t)})}function cs({title:t,taskStatus:s}){return e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0 overflow-hidden mr-2",children:[e.jsx("div",{className:"flex items-center",children:e.jsx(rs,{taskStatus:s})}),e.jsx(ue,{version:"V1"}),e.jsx("h3",{className:"text-sm font-medium text-neutral-100 truncate flex-1",children:t}),e.jsx(ls,{taskStatus:s})]})}function ds({selectedRepository:t,createdAt:s,detail:n}){const{t:a}=g();return e.jsxs("div",{className:S("flex flex-col gap-1 mt-1"),children:[e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[t?e.jsx(Ee,{selectedRepository:t}):e.jsx(Ne,{}),s&&e.jsx("p",{className:"text-xs text-[#A3A3A3] flex-1 text-right",children:e.jsx("time",{children:`${le(new Date(s))} ${a(i.CONVERSATION$AGO)}`})})]}),n&&e.jsx("div",{className:"text-xs text-neutral-500 truncate",children:n})]})}function us({task:t,onClick:s}){const{t:n}=g(),a=t.request.title||t.detail||n(i.CONVERSATION$STARTING_CONVERSATION),o=t.request.selected_repository?{selected_repository:t.request.selected_repository,selected_branch:t.request.selected_branch||null,git_provider:t.request.git_provider||null}:null;return e.jsxs("div",{"data-testid":"start-task-card",onClick:s,className:S("relative h-auto w-full p-3.5 border-b border-neutral-600 cursor-pointer","hover:bg-[#454545]"),children:[e.jsx("div",{className:"flex items-center justify-between w-full",children:e.jsx(cs,{title:a,taskStatus:t.status})}),e.jsx(ds,{selectedRepository:o,createdAt:t.created_at,detail:t.detail})]})}function ms({onClose:t}){const{t:s}=g(),{conversationId:n}=be(),a=X(t),o=W(),[r,d]=f.useState(!1),[x,l]=f.useState(!1),[c,h]=f.useState(!1),[p,v]=f.useState(null),[C,E]=f.useState(void 0),[_,A]=f.useState(null),{data:k,isFetching:O,error:$,hasNextPage:G,isFetchingNextPage:w,fetchNextPage:N}=Be(),{data:M}=Xt(),B=k?.pages.flatMap(m=>m.results)??[],{mutate:ve}=Je(),{mutate:Se}=Qe(),{mutate:_e}=et(),Q=Ge({hasNextPage:!!G,isFetchingNextPage:w,fetchNextPage:N,threshold:200}),Ae=m=>{d(!0),v(m)},we=(m,L)=>{l(!0),v(m),E(L)},Ie=async(m,L)=>{_e({conversationId:m,newTitle:L},{onSuccess:()=>{fe(s(i.CONVERSATION$TITLE_UPDATED))}})},je=()=>{p&&ve({conversationId:p},{onSuccess:()=>{p===n&&o("/")}})},Oe=()=>{p&&Se({conversationId:p,version:C})};return e.jsxs("div",{ref:m=>{a.current!==m&&(a.current=m),Q.current!==m&&(Q.current=m)},"data-testid":"conversation-panel",className:"w-full md:w-[400px] h-full border border-[#525252] bg-[#25272D] rounded-lg overflow-y-auto absolute custom-scrollbar-always",children:[O&&B.length===0&&e.jsx("div",{className:"w-full h-full absolute flex justify-center items-center",children:e.jsx(H,{size:"small"})}),$&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsx("p",{className:"text-danger",children:$.message})}),!O&&B?.length===0&&!M?.length&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsx("p",{className:"text-neutral-400",children:s(i.CONVERSATION$NO_CONVERSATIONS)})}),M?.map(m=>e.jsx(ee,{to:`/conversations/task-${m.id}`,onClick:t,children:e.jsx(us,{task:m})},m.id)),B?.map(m=>e.jsx(ee,{to:`/conversations/${m.conversation_id}`,onClick:t,children:e.jsx(is,{onDelete:()=>Ae(m.conversation_id),onStop:()=>we(m.conversation_id,m.conversation_version),onChangeTitle:L=>Ie(m.conversation_id,L),title:m.title,selectedRepository:{selected_repository:m.selected_repository,selected_branch:m.selected_branch,git_provider:m.git_provider},lastUpdatedAt:m.last_updated_at,createdAt:m.created_at,conversationStatus:m.status,conversationId:m.conversation_id,conversationVersion:m.conversation_version,contextMenuOpen:_===m.conversation_id,onContextMenuToggle:L=>A(L?m.conversation_id:null)})},m.conversation_id)),w&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(H,{size:"small"})}),r&&e.jsx(tt,{onConfirm:()=>{je(),d(!1)},onCancel:()=>d(!1)}),x&&e.jsx(st,{onConfirm:()=>{Oe(),l(!1)},onCancel:()=>l(!1)}),c&&e.jsx(qt,{onConfirm:()=>{t()},onClose:()=>h(!1)})]})}function hs({isOpen:t,children:s}){const{pathname:n}=j();if(!t)return null;const a=document.getElementById("root-outlet");return a?It.createPortal(e.jsx("div",{className:S("absolute h-full w-full left-0 top-0 z-[9999] bg-black/80 rounded-xl",n==="/"&&"bottom-0 top-0 md:top-3 md:bottom-3 h-auto"),children:s}),a):null}const fs=t=>u.createElement("svg",{width:47,height:42,viewBox:"0 0 47 42",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},u.createElement("path",{d:"M2.58409 21.782C2.01747 21.782 1.48418 22.0153 1.11755 22.3819C0.750916 22.7486 0.517578 23.3152 0.517578 23.8485V28.0148C0.517578 28.5814 0.750916 29.1147 1.11755 29.4813C1.51751 29.8813 2.05081 30.0813 2.58409 30.0813C3.11737 30.0813 3.684 29.8479 4.05063 29.4813C4.45059 29.0814 4.65055 28.5481 4.65055 28.0148V23.8485C4.65055 23.2819 4.41726 22.7486 4.05063 22.3819C3.684 22.0153 3.11737 21.782 2.58409 21.782ZM44.2802 21.782C43.7136 21.782 43.1803 22.0153 42.8137 22.3819C42.4471 22.7486 42.2138 23.3152 42.2138 23.8485V28.0148C42.2138 28.5814 42.4471 29.1147 42.8137 29.4813C43.2137 29.8813 43.747 30.0813 44.2802 30.0813C44.8135 30.0813 45.3801 29.8479 45.7468 29.4813C46.1467 29.0814 46.3467 28.5481 46.3467 28.0148V23.8485C46.3467 23.2819 46.1134 22.7486 45.7468 22.3819C45.3801 22.0153 44.8135 21.782 44.2802 21.782ZM21.349 10.3164H13.0164C11.3499 10.3164 9.75011 10.983 8.58355 12.1496C7.41699 13.3161 6.75037 14.916 6.75037 16.5825V35.3474C6.75037 37.0139 7.41699 38.6138 8.58355 39.7804C9.75011 40.9469 11.3499 41.6135 13.0164 41.6135H33.8812C35.5477 41.6135 37.1476 40.9469 38.3141 39.7804C39.4807 38.6138 40.1473 37.0139 40.1473 35.3474V16.5825C40.1473 14.916 39.4807 13.3161 38.3141 12.1496C37.1476 10.983 35.5477 10.3164 33.8812 10.3164H25.5486M19.8491 14.4827H27.0152ZM31.3148 14.4827H33.8478C34.4145 14.4827 34.9478 14.716 35.3144 15.0826C35.7144 15.4826 35.9144 16.0159 35.9144 16.5492V35.3141C35.9144 35.8807 35.681 36.3807 35.3144 36.7806C34.9144 37.1806 34.3811 37.3806 33.8478 37.3806H12.9831C12.4165 37.3806 11.8832 37.1473 11.5166 36.7806C11.1166 36.3807 10.9167 35.8474 10.9167 35.3141V16.5492C10.9167 15.9825 11.1499 15.4493 11.5166 15.0826C11.9165 14.6827 12.4498 14.4827 12.9831 14.4827H15.5162M17.7494 21.782C17.1828 21.782 16.6495 22.0153 16.2828 22.3819C15.9162 22.7486 15.6829 23.3152 15.6829 23.8485V28.0148C15.6829 28.5814 15.9162 29.1147 16.2828 29.4813C16.6828 29.8813 17.2161 30.0813 17.7494 30.0813C18.2827 30.0813 18.8492 29.8479 19.2159 29.4813C19.6158 29.0814 19.8158 28.5481 19.8158 28.0148V23.8485C19.8158 23.2819 19.5825 22.7486 19.2159 22.3819C18.8492 22.0153 18.2827 21.782 17.7494 21.782ZM29.0816 21.782C28.515 21.782 27.9817 22.0153 27.6151 22.3819C27.2485 22.7486 27.0152 23.3152 27.0152 23.8485V28.0148C27.0152 28.5814 27.2485 29.1147 27.6151 29.4813C28.0151 29.8813 28.5484 30.0813 29.0816 30.0813C29.6149 30.0813 30.1816 29.8479 30.5482 29.4813C30.9481 29.0814 31.1481 28.5481 31.1481 28.0148V23.8485C31.1481 23.2819 30.9148 22.7486 30.5482 22.3819C30.1816 22.0153 29.6149 21.782 29.0816 21.782Z",fill:"currentColor"}),u.createElement("path",{d:"M23.4122 0.851806C22.7122 0.851806 22.0123 1.05179 21.4123 1.45175C20.8124 1.85171 20.3791 2.41834 20.0791 3.05162C19.8125 3.71822 19.7458 4.41814 19.8792 5.11808C20.0125 5.81801 20.3458 6.4513 20.8457 6.95125C21.3457 7.45121 21.979 7.78451 22.6789 7.91783C23.3788 8.05115 24.1121 7.98448 24.7454 7.71783C25.412 7.45119 25.9452 6.98459 26.3452 6.38464C26.7452 5.7847 26.9452 5.11807 26.9452 4.38481C26.9452 3.41823 26.5785 2.51833 25.8786 1.85172C25.1786 1.18512 24.2787 0.785156 23.3455 0.785156L23.4122 0.851806Z",fill:"currentColor"}));function xs({disabled:t=!1}){const{t:s}=g(),n=s(i.MICROAGENT_MANAGEMENT$TITLE);return e.jsx(z,{tooltip:n,ariaLabel:n,navLinkTo:"/microagent-management",testId:"microagent-management-button",disabled:t,children:e.jsx(fs,{width:28,height:28})})}function ps(){const t=j(),s=Ce(),{data:n}=b(),{data:a,error:o,isError:r,isFetching:d}=J(),{mutate:x}=jt(),[l,c]=f.useState(!1),[h,p]=f.useState(!1),{pathname:v}=j(),C=n?.FEATURE_FLAGS.HIDE_LLM_SETTINGS&&n?.APP_MODE==="saas";return f.useEffect(()=>{C||(t.pathname==="/settings"?c(!1):!d&&r&&o?.status!==404?xe("Something went wrong while fetching settings. Please reload the page."):n?.APP_MODE==="oss"&&o?.status===404&&c(!0))},[o?.status,o,d,t.pathname]),e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:S("h-[54px] p-3 md:p-0 md:h-[40px] md:h-auto flex flex-row md:flex-col gap-1 bg-base md:w-[75px] md:min-w-[75px] sm:pt-0 sm:px-2 md:pt-[14px] md:px-0",v==="/"&&"md:pt-6.5 md:pb-3"),children:[e.jsxs("nav",{className:"flex flex-row md:flex-col items-center justify-between w-full h-auto md:w-auto md:h-full",children:[e.jsxs("div",{className:"flex flex-row md:flex-col items-center gap-[26px]",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Ft,{})}),e.jsx("div",{children:e.jsx(Ht,{disabled:a?.EMAIL_VERIFIED===!1})}),e.jsx(Yt,{isOpen:h,onClick:()=>a?.EMAIL_VERIFIED===!1?null:p(E=>!E),disabled:a?.EMAIL_VERIFIED===!1}),e.jsx(xs,{disabled:a?.EMAIL_VERIFIED===!1})]}),e.jsx("div",{className:"flex flex-row md:flex-col md:items-center gap-[26px]",children:e.jsx(Vt,{user:s.data?{avatar_url:s.data.avatar_url}:void 0,onLogout:x,isLoading:s.isFetching})})]}),h&&e.jsx(hs,{isOpen:h,children:e.jsx(ms,{onClose:()=>p(!1)})})]}),l&&e.jsx(Zt,{settings:a,onClose:()=>c(!1)})]})}const gs=t=>u.createElement("svg",{width:22,height:22,viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},u.createElement("path",{d:"M12 2.25C6.624 2.25 2.25 6.624 2.25 12C2.25 16.376 5.115 20.073 9.057 21.428C9.563 21.514 9.747 21.211 9.747 20.95C9.747 20.713 9.738 19.991 9.738 19.153C7 19.713 6.4 18.45 6.4 18.45C5.952 17.387 5.328 17.084 5.328 17.084C4.476 16.487 5.387 16.487 5.387 16.487C6.328 16.546 6.85 17.481 6.85 17.481C7.675 18.862 9.057 18.487 9.776 18.226C9.867 17.603 10.133 17.179 10.419 16.94C8.287 16.713 6.05 15.85 6.05 11.9C6.05 10.837 6.4 9.975 6.859 9.3C6.759 9.05 6.45 8.038 6.95 6.65C6.95 6.65 7.734 6.4 9.738 7.775C10.483 7.534 11.25 7.413 12.017 7.413C12.784 7.413 13.55 7.534 14.296 7.775C16.3 6.4 17.084 6.65 17.084 6.65C17.584 8.038 17.275 9.05 17.175 9.3C17.634 9.975 17.984 10.837 17.984 11.9C17.984 15.85 15.747 16.7 13.615 16.94C13.975 17.237 14.296 17.813 14.296 18.7C14.296 19.975 14.287 20.6 14.287 20.95C14.287 21.211 14.471 21.514 14.977 21.428C18.919 20.073 21.784 16.376 21.784 12C21.784 6.624 17.376 2.25 12 2.25Z",fill:"currentColor"})),Cs=t=>u.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"97 99 186 182",...t},u.createElement("defs",null,u.createElement("style",null,".cls-1{fill:currentColor;}")),u.createElement("g",{id:"LOGO"},u.createElement("path",{className:"cls-1",d:"M282.83,170.73l-.27-.69-26.14-68.22a6.81,6.81,0,0,0-2.69-3.24,7,7,0,0,0-8,.43,7,7,0,0,0-2.32,3.52l-17.65,54H154.29l-17.65-54A6.86,6.86,0,0,0,134.32,99a7,7,0,0,0-8-.43,6.87,6.87,0,0,0-2.69,3.24L97.44,170l-.26.69a48.54,48.54,0,0,0,16.1,56.1l.09.07.24.17,39.82,29.82,19.7,14.91,12,9.06a8.07,8.07,0,0,0,9.76,0l12-9.06,19.7-14.91,40.06-30,.1-.08A48.56,48.56,0,0,0,282.83,170.73Z"}))),Es=t=>u.createElement("svg",{role:"img",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",...t},u.createElement("title",null,"Bitbucket"),u.createElement("path",{d:"M.778 1.213a.768.768 0 00-.768.892l3.263 19.81c.084.5.515.868 1.022.873H19.95a.772.772 0 00.77-.646l3.27-20.03a.768.768 0 00-.768-.891zM14.52 15.53H9.522L8.17 8.466h7.561z"}));function Ns({githubAuthUrl:t,appMode:s,authUrl:n,providersConfigured:a}){const{t:o}=g(),r=T({appMode:s||null,identityProvider:"gitlab",authUrl:n}),d=T({appMode:s||null,identityProvider:"bitbucket",authUrl:n}),x=T({appMode:s||null,identityProvider:"enterprise_sso",authUrl:n}),l=()=>{t&&(window.location.href=t)},c=()=>{r&&(window.location.href=r)},h=()=>{d&&(window.location.href=d)},p=()=>{x&&(window.location.href=x)},v=a&&a.length>0&&a.includes("github"),C=a&&a.length>0&&a.includes("gitlab"),E=a&&a.length>0&&a.includes("bitbucket"),_=a&&a.length>0&&a.includes("enterprise_sso"),A=!a||a.length===0;return e.jsx(U,{children:e.jsxs(V,{className:"border border-tertiary",children:[e.jsx(Y,{width:68,height:46}),e.jsx("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:e.jsx("h1",{className:"text-2xl font-bold",children:o(i.AUTH$SIGN_IN_WITH_IDENTITY_PROVIDER)})}),e.jsx("div",{className:"flex flex-col gap-3 w-full",children:A?e.jsx("div",{className:"text-center p-4 text-muted-foreground",children:o(i.AUTH$NO_PROVIDERS_CONFIGURED)}):e.jsxs(e.Fragment,{children:[v&&e.jsx(D,{type:"button",variant:"primary",onClick:l,className:"w-full font-semibold",startContent:e.jsx(gs,{width:20,height:20}),children:o(i.GITHUB$CONNECT_TO_GITHUB)}),C&&e.jsx(D,{type:"button",variant:"primary",onClick:c,className:"w-full font-semibold",startContent:e.jsx(Cs,{width:20,height:20}),children:o(i.GITLAB$CONNECT_TO_GITLAB)}),E&&e.jsx(D,{type:"button",variant:"primary",onClick:h,className:"w-full font-semibold",startContent:e.jsx(Es,{width:20,height:20}),children:o(i.BITBUCKET$CONNECT_TO_BITBUCKET)}),_&&e.jsx(D,{type:"button",variant:"primary",onClick:p,className:"w-full font-semibold",children:o(i.ENTERPRISE_SSO$CONNECT_TO_ENTERPRISE_SSO)})]})}),e.jsxs("p",{className:"mt-4 text-xs text-center text-muted-foreground","data-testid":"auth-modal-terms-of-service",children:[o(i.AUTH$BY_SIGNING_UP_YOU_AGREE_TO_OUR)," ",e.jsx("a",{href:"https://www.all-hands.dev/tos",target:"_blank",className:"underline hover:text-primary",rel:"noopener noreferrer",children:o(i.COMMON$TERMS_OF_SERVICE)})," ",o(i.COMMON$AND)," ",e.jsx("a",{href:"https://www.all-hands.dev/privacy",target:"_blank",className:"underline hover:text-primary",rel:"noopener noreferrer",children:o(i.COMMON$PRIVACY_POLICY)}),"."]})]})})}function vs(){const{t}=g();return e.jsx(U,{children:e.jsxs(V,{className:"border border-tertiary",children:[e.jsx(Y,{width:68,height:46}),e.jsx("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:e.jsx("h1",{className:"text-2xl font-bold",children:t(i.AUTH$LOGGING_BACK_IN)})})]})})}function Ss({onClose:t}){const{t:s}=g(),{mutate:n}=q(),a=async o=>{o.preventDefault();const d=new FormData(o.currentTarget).get("analytics")==="on";n({user_consents_to_analytics:d},{onSuccess:()=>{ge(d),t()}})};return e.jsx(U,{children:e.jsx("form",{"data-testid":"user-capture-consent-form",onSubmit:a,className:"flex flex-col gap-2",children:e.jsxs(V,{className:"border border-tertiary",children:[e.jsx(he,{title:s(i.ANALYTICS$TITLE)}),e.jsx(dt,{children:s(i.ANALYTICS$DESCRIPTION)}),e.jsxs("label",{className:"flex gap-2 items-center self-start text-sm",children:[e.jsx("input",{name:"analytics",type:"checkbox",defaultChecked:!0}),s(i.ANALYTICS$SEND_ANONYMOUS_DATA)]}),e.jsx(D,{testId:"confirm-preferences",type:"submit",variant:"primary",className:"w-full",children:s(i.ANALYTICS$CONFIRM_PREFERENCES)})]})})})}const _s=()=>{const{mutate:t}=q();return{migrateUserConsent:f.useCallback(async n=>{const a=localStorage.getItem("analytics-consent");a&&(n?.handleAnalyticsWasPresentInLocalStorage(),await t({user_consents_to_analytics:a==="true"},{onSuccess:()=>{ge(a==="true")}}),localStorage.removeItem("analytics-consent"))},[])}};function As(){const{t}=g(),{mutate:s,isPending:n}=mt({mutationFn:Tt.createBillingSessionResponse,onSuccess:a=>{window.location.href=a},onError:()=>{xe(t(i.BILLING$ERROR_WHILE_CREATING_SESSION))}});return e.jsx(U,{children:e.jsxs(V,{className:"border border-tertiary",children:[e.jsx(Y,{width:68,height:46}),e.jsxs("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t(i.BILLING$YOUVE_GOT_50)}),e.jsx("p",{children:e.jsx(Mt,{i18nKey:"BILLING$CLAIM_YOUR_50",components:{b:e.jsx("strong",{})}})})]}),e.jsx(D,{testId:"proceed-to-stripe-button",type:"submit",variant:"primary",className:"w-full",isDisabled:n,onClick:s,children:t(i.BILLING$PROCEED_TO_STRIPE)})]})})}const ws=()=>{const{data:t,isLoading:s}=b(),{data:n,isLoading:a}=K(),o=pe(),r=T({appMode:t?.APP_MODE||null,identityProvider:"github",authUrl:t?.AUTH_URL}),d=T({appMode:t?.APP_MODE||null,identityProvider:"gitlab",authUrl:t?.AUTH_URL}),x=T({appMode:t?.APP_MODE||null,identityProvider:"bitbucket",authUrl:t?.AUTH_URL}),l=T({appMode:t?.APP_MODE||null,identityProvider:"enterprise_sso",authUrl:t?.AUTH_URL});u.useEffect(()=>{if(t?.APP_MODE!=="saas"||s||a||n||!o)return;let c=null;if(o===P.GITHUB?c=r:o===P.GITLAB?c=d:o===P.BITBUCKET?c=x:o===P.ENTERPRISE_SSO&&(c=l),c){const h=new URL(c);h.searchParams.append("login_method",o),window.location.href=h.toString()}},[t?.APP_MODE,n,s,a,o,r,d,x,l])},Is=()=>{const t=j(),{data:s,isLoading:n}=K(),{data:a}=b(),o=W();u.useEffect(()=>{if(a?.APP_MODE!=="saas"||n||!s)return;const r=new URLSearchParams(t.search),d=r.get("login_method");if(Object.values(P).includes(d)){Ot(d),r.delete("login_method");const x=`${t.pathname}${r.toString()?`?${r.toString()}`:""}`;o(x,{replace:!0})}},[s,n,t.search,a?.APP_MODE])},oe="6bac7145b4ee6ec";class js{initialized=!1;scriptLoaded=!1;async init(){if(!this.initialized)try{await this.loadScript(),window.Reo&&(window.Reo.init({clientID:oe}),this.initialized=!0)}catch(s){console.error("Failed to initialize Reo.dev tracking:",s)}}loadScript(){return new Promise((s,n)=>{if(this.scriptLoaded){s();return}const a=document.createElement("script");a.src=`https://static.reo.dev/${oe}/reo.js`,a.defer=!0,a.onload=()=>{this.scriptLoaded=!0,s()},a.onerror=()=>{n(new Error("Failed to load Reo.dev script"))},document.head.appendChild(a)})}identify(s){if(!this.initialized){console.warn("Reo.dev not initialized. Call init() first.");return}try{window.Reo&&window.Reo.identify(s)}catch(n){console.error("Failed to identify user in Reo.dev:",n)}}isInitialized(){return this.initialized}}const F=new js,Os=t=>{switch(t){case P.GITHUB:return"github";case P.ENTERPRISE_SSO:return"email";default:return"email"}},Ts=t=>{if(t)return[{username:t,type:"email"}]},bs=t=>{if(!t)return{};const[s,...n]=t.split(" ");return s?{firstname:s,lastname:n.length>0?n.join(" "):void 0}:{}},Ms=(t,s)=>{const{firstname:n,lastname:a}=bs(t.name);return{username:t.login,type:Os(s),other_identities:Ts(t.email),firstname:n,lastname:a,company:t.company||void 0}},Ls=()=>{const{data:t}=b(),{data:s}=Ce(),[n,a]=f.useState(!1);f.useEffect(()=>{(async()=>{t?.APP_MODE==="saas"&&se()&&!F.isInitialized()&&await F.init()})()},[t?.APP_MODE]),f.useEffect(()=>{if(t?.APP_MODE!=="saas"||!se()||!s||n||!F.isInitialized())return;const o=pe();if(!o)return;const r=Ms(s,o);F.identify(r),a(!0)},[t?.APP_MODE,s,n])};function Rs({children:t}){const{data:s,isLoading:n}=J(),a=W(),{pathname:o}=j();return f.useEffect(()=>{n||s?.EMAIL_VERIFIED===!1&&o!=="/settings/user"&&a("/settings/user",{replace:!0})},[s?.EMAIL_VERIFIED,o,a,n]),t}function ys({startTime:t}){const{t:s}=g(),[n,a]=nt("maintenance_banner_dismissed_at",null),{pathname:o}=j(),d=(l=>{try{let c;if(l.includes("T")&&(l.includes("-05:00")||l.includes("-04:00")||l.includes("EST")||l.includes("EDT")))c=new Date(l);else{const h=new Date(l);if(Number.isNaN(h.getTime()))throw new Error("Invalid date");c=h}return c.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"short"})}catch(c){return console.warn("Failed to parse maintenance time:",c),l}})(t);return u.useMemo(()=>Number.isNaN(new Date(t).getTime())?!1:n!==d,[n,t])?e.jsxs("div",{"data-testid":"maintenance-banner",className:S("bg-primary text-[#0D0F11] p-4 rounded","flex flex-row items-center justify-between m-1",o==="/"&&"mt-3 mr-3"),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(At,{className:"text-white align-middle"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium",children:s("MAINTENANCE$SCHEDULED_MESSAGE",{time:d})})})]}),e.jsx("button",{type:"button","data-testid":"dismiss-button",onClick:()=>a(d),className:S("bg-[#0D0F11] rounded-full w-5 h-5 flex items-center justify-center cursor-pointer"),children:e.jsx(Lt,{})})]}):null}const Tn=Me(function(){const s=ye(),{t:n}=g();return De(s)?e.jsxs("div",{children:[e.jsx("h1",{children:s.status}),e.jsx("p",{children:s.statusText}),e.jsx("pre",{children:s.data instanceof Object?JSON.stringify(s.data):s.data})]}):s instanceof Error?e.jsxs("div",{children:[e.jsx("h1",{children:n(i.ERROR$GENERIC)}),e.jsx("pre",{children:s.message})]}):e.jsx("div",{children:e.jsx("h1",{children:n(i.ERROR$UNKNOWN)})})}),bn=Le(function(){const s=W(),{pathname:n}=j(),a=Pe(),{data:o}=J(),{error:r}=bt(),{migrateUserConsent:d}=_s(),{t:x}=g(),l=b(),{data:c,isFetching:h,isError:p}=K(),v=Dt({appMode:l.data?.APP_MODE||null,gitHubClientId:l.data?.GITHUB_CLIENT_ID||null,authUrl:l.data?.AUTH_URL}),C=a?null:v,[E,_]=f.useState(!1);ws(),Is(),Ls(),f.useEffect(()=>{!a&&o?.LANGUAGE&&Rt.changeLanguage(o.LANGUAGE)},[o?.LANGUAGE,a]),f.useEffect(()=>{if(!a){const w=o?.USER_CONSENTS_TO_ANALYTICS===null;_(w)}},[o,a]),f.useEffect(()=>{a||d({handleAnalyticsWasPresentInLocalStorage:()=>{_(!1)}})},[a]),f.useEffect(()=>{o?.IS_NEW_USER&&l.data?.APP_MODE==="saas"&&fe(x(i.BILLING$YOURE_IN))},[o?.IS_NEW_USER,l.data?.APP_MODE]),f.useEffect(()=>{!a&&r?.status===402&&n!=="/"&&s("/")},[r?.status,n,a]);const A=f.useCallback(()=>typeof window<"u"&&window.localStorage?localStorage.getItem(ae.LOGIN_METHOD)!==null:!1,[]),[k,O]=f.useState(A());f.useEffect(()=>{const w=M=>{M.key===ae.LOGIN_METHOD&&O(A())},N=()=>{O(A())};return window.addEventListener("storage",w),window.addEventListener("focus",N),()=>{window.removeEventListener("storage",w),window.removeEventListener("focus",N)}},[A]),f.useEffect(()=>{O(A())},[c,A]);const $=!c&&!p&&!h&&!a&&l.data?.APP_MODE==="saas"&&!k,G=!c&&!p&&!h&&!a&&l.data?.APP_MODE==="saas"&&k;return e.jsxs("div",{"data-testid":"root-layout",className:S("h-screen lg:min-w-[1024px] flex flex-col md:flex-row bg-base",n==="/"?"p-0":"p-0 md:p-3 md:pl-0",Ve()&&"overflow-hidden"),children:[e.jsx(ps,{}),e.jsxs("div",{className:"flex flex-col w-full h-[calc(100%-50px)] md:h-full gap-3",children:[l.data?.MAINTENANCE&&e.jsx(ys,{startTime:l.data.MAINTENANCE.startTime}),e.jsx("div",{id:"root-outlet",className:"flex-1 relative overflow-auto custom-scrollbar",children:e.jsx(Rs,{children:e.jsx(Re,{})})})]}),$&&e.jsx(Ns,{githubAuthUrl:C,appMode:l.data?.APP_MODE,providersConfigured:l.data?.PROVIDERS_CONFIGURED,authUrl:l.data?.AUTH_URL}),G&&e.jsx(vs,{}),l.data?.APP_MODE==="oss"&&E&&e.jsx(Ss,{onClose:()=>{_(!1)}}),l.data?.FEATURE_FLAGS.ENABLE_BILLING&&l.data?.APP_MODE==="saas"&&o?.IS_NEW_USER&&e.jsx(As,{})]})});export{Tn as ErrorBoundary,bn as default};
