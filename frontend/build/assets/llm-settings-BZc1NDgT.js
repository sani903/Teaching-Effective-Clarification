import{p as t,w as Ie,D as ue,R as d}from"./chunk-NISHYRIK-CgksP-ke.js";import{o as B,e as me,u as Ne,M as Ae,D as R,H as L}from"./model-selector-BRqT5jIE.js";import{D as r,u as _e}from"./use-settings-y2Eq7ITW.js";import{u as Te,g as he}from"./use-save-settings-C2NDO2vm.js";import{I as f,S as O}from"./input-skeleton-gXNr_glO.js";import{T as fe}from"./tooltip-button-CGDIzzom.js";import{S as Le}from"./question-circle-BYpHJBA-.js";import{I as l}from"./declaration-BLNM_M5s.js";import{S as I}from"./settings-input-Blv1eH9r.js";import{B as xe}from"./brand-button-BLaTuvKj.js";import{a as k,d as F}from"./custom-toast-handlers-B_1yfMGT.js";import{r as ye}from"./retrieve-axios-error-message-CYr77e_f.js";import{S as z}from"./settings-dropdown-input-DCArA_yj.js";import{u as ge}from"./use-config-BtaDlBUv.js";import{S as Me,K as D}from"./key-status-icon-CkIynbwO.js";import{S as b}from"./switch-skeleton-DlDbJHwW.js";import{u as H}from"./useTranslation-BhtO8iYN.js";import"./option-service.api-L97_35Hu.js";import"./open-hands-axios-DsgPCc-0.js";import"./utils-C5iw9p3M.js";import"./index-0urWFDHv.js";import"./chunk-S6H5EOGR-BBckzTk7.js";import"./useSingleSelectListState-D8PQAT0i.js";import"./index-BBSevn_K.js";import"./preload-helper-BhQ1_4_d.js";import"./module-CWLbpm_7.js";import"./use-is-authed-CJdzFdqm.js";import"./optional-tag-C2att6n-.js";import"./index-DJ6Yt2gU.js";const Ce=n=>Object.keys(n).length>0&&(!!n.LLM_BASE_URL||n.AGENT!==r.AGENT),Re=(n,c)=>{if(!c)return!1;const S=B(n),{provider:u,model:m}=me(c);return!(u in S&&S[u].models.includes(m))};function Oe(){return t.jsxs("div",{"data-testid":"app-settings-skeleton",className:"px-11 py-9 flex flex-col gap-6",children:[t.jsx(b,{}),t.jsx(f,{}),t.jsx(f,{}),t.jsx(f,{}),t.jsx(Me,{}),t.jsx(b,{}),t.jsx(b,{}),t.jsx(f,{})]})}function Z({testId:n}){const{t:c}=H();return t.jsxs(t.Fragment,{children:[t.jsx(L,{testId:n,text:c(l.SETTINGS$OPENHANDS_API_KEY_HELP_TEXT),linkText:c(l.SETTINGS$NAV_API_KEYS),href:"https://app.all-hands.dev/settings/api-keys",suffix:` ${c(l.SETTINGS$OPENHANDS_API_KEY_HELP_SUFFIX)}`}),t.jsxs("p",{className:"text-xs",children:[c(l.SETTINGS$LLM_BILLING_INFO)," ",t.jsx("a",{href:"https://docs.all-hands.dev/usage/llms/openhands-llms",rel:"noreferrer noopener",target:"_blank",className:"underline underline-offset-2",children:c(l.SETTINGS$SEE_PRICING_DETAILS)})]})]})}function De(){const{t:n}=H(),[c,S]=ue(),{mutate:u,isPending:m}=Te(),{data:E}=Ne(),{data:s,isLoading:V,isFetching:Y}=_e(),{data:X}=ge(),[N,x]=d.useState("basic"),[W,o]=d.useState({model:!1,apiKey:!1,searchApiKey:!1,baseUrl:!1,agent:!1,confirmationMode:!1,enableDefaultCondenser:!1,securityAnalyzer:!1,condenserMaxSize:!1}),[v,y]=d.useState(null),[Q,j]=d.useState(s?.CONFIRMATION_MODE??r.CONFIRMATION_MODE),[g,_]=d.useState(s?.SECURITY_ANALYZER===null?"none":s?.SECURITY_ANALYZER??r.SECURITY_ANALYZER),q=B(E?.models||[]);d.useEffect(()=>{const a=E&&s?Re(E.models,s.LLM_MODEL)||Ce({...s}):!1;x(a?"advanced":"basic")},[s,E]),d.useEffect(()=>{s?.LLM_MODEL&&y(s.LLM_MODEL)},[s?.LLM_MODEL]),d.useEffect(()=>{s?.CONFIRMATION_MODE!==void 0&&j(s.CONFIRMATION_MODE)},[s?.CONFIRMATION_MODE]),d.useEffect(()=>{s?.SECURITY_ANALYZER!==void 0&&_(s.SECURITY_ANALYZER||"none")},[s?.SECURITY_ANALYZER]),d.useEffect(()=>{const e=c.get("checkout");e==="success"?(k(n(l.SUBSCRIPTION$SUCCESS)),S({})):e==="cancel"&&(F(n(l.SUBSCRIPTION$FAILURE)),S({}))},[c,S,n]);const K=()=>{k(n(l.SETTINGS$SAVED_WARNING)),o({model:!1,apiKey:!1,searchApiKey:!1,baseUrl:!1,agent:!1,confirmationMode:!1,enableDefaultCondenser:!1,securityAnalyzer:!1,condenserMaxSize:!1})},U=e=>{const a=ye(e);F(a||n(l.ERROR$GENERIC))},J=e=>{const a=e.get("llm-provider-input")?.toString(),i=a?he(a):void 0,p=e.get("llm-model-input")?.toString(),A=e.get("llm-api-key-input")?.toString(),M=e.get("search-api-key-input")?.toString(),C=e.get("enable-confirmation-mode-switch")?.toString()==="on",T=e.get("security-analyzer-input")?.toString(),h=i&&p&&`${i}/${p}`;u({LLM_MODEL:h,llm_api_key:A||null,SEARCH_API_KEY:M||"",CONFIRMATION_MODE:C,SECURITY_ANALYZER:T==="none"?null:T||r.SECURITY_ANALYZER,LLM_BASE_URL:r.LLM_BASE_URL,AGENT:r.AGENT,ENABLE_DEFAULT_CONDENSER:r.ENABLE_DEFAULT_CONDENSER},{onSuccess:K,onError:U})},ee=e=>{const a=e.get("llm-custom-model-input")?.toString(),i=e.get("base-url-input")?.toString(),p=e.get("llm-api-key-input")?.toString(),A=e.get("search-api-key-input")?.toString(),M=e.get("agent-input")?.toString(),C=e.get("enable-confirmation-mode-switch")?.toString()==="on",T=e.get("enable-memory-condenser-switch")?.toString()==="on",h=e.get("condenser-max-size-input")?.toString(),w=h?Number.parseInt(h,10):void 0,pe=w!==void 0?Math.max(20,w):void 0,$=e.get("security-analyzer-input")?.toString();u({LLM_MODEL:a,LLM_BASE_URL:i,llm_api_key:p||null,SEARCH_API_KEY:A||"",AGENT:M,CONFIRMATION_MODE:C,ENABLE_DEFAULT_CONDENSER:T,CONDENSER_MAX_SIZE:pe??r.CONDENSER_MAX_SIZE,SECURITY_ANALYZER:$==="none"?null:$||r.SECURITY_ANALYZER},{onSuccess:K,onError:U})},te=e=>{x(e?"advanced":"basic"),o({model:!1,apiKey:!1,searchApiKey:!1,baseUrl:!1,agent:!1,confirmationMode:!1,enableDefaultCondenser:!1,securityAnalyzer:!1,condenserMaxSize:!1})},se=e=>{const a=e!==s?.LLM_MODEL.replace("openai/","");o(i=>({...i,model:a})),y(e)},P=e=>{const a=e!=="";o(i=>({...i,apiKey:a}))},ne=e=>{const a=e!==s?.SEARCH_API_KEY;o(i=>({...i,searchApiKey:a}))},ae=e=>{const a=e!==s?.LLM_MODEL&&e!=="";o(i=>({...i,model:a})),y(e)},le=e=>{const a=e!==s?.LLM_BASE_URL;o(i=>({...i,baseUrl:a}))},ie=e=>{const a=e!==s?.AGENT&&e!=="";o(i=>({...i,agent:a}))},oe=e=>{const a=e!==s?.CONFIRMATION_MODE;o(i=>({...i,confirmationMode:a})),j(e),e&&!g&&(_(r.SECURITY_ANALYZER),o(i=>({...i,securityAnalyzer:!0})))},re=e=>{const a=e!==s?.ENABLE_DEFAULT_CONDENSER;o(i=>({...i,enableDefaultCondenser:a}))},ce=e=>{const a=e?Number.parseInt(e,10):void 0,p=((a!==void 0?Math.max(20,a):void 0)??r.CONDENSER_MAX_SIZE)!==(s?.CONDENSER_MAX_SIZE??r.CONDENSER_MAX_SIZE);o(A=>({...A,condenserMaxSize:p}))},G=e=>{const a=e!==s?.SECURITY_ANALYZER;o(i=>({...i,securityAnalyzer:a}))},de=Object.values(W).some(e=>e),Ee=()=>{const e=E?.securityAnalyzers||[],a=[];return e.includes("llm")&&a.push({key:"llm",label:n(l.SETTINGS$SECURITY_ANALYZER_LLM_DEFAULT)}),a.push({key:"none",label:n(l.SETTINGS$SECURITY_ANALYZER_NONE)}),e.includes("invariant")&&a.push({key:"invariant",label:n(l.SETTINGS$SECURITY_ANALYZER_INVARIANT)}),e.forEach(i=>{["llm","invariant","none"].includes(i)||a.push({key:i,label:i})}),a};if(!s||Y)return t.jsx(Oe,{});const Se=e=>{N==="basic"?J(e):ee(e)};return t.jsx("div",{"data-testid":"llm-settings-screen",className:"h-full relative",children:t.jsxs("form",{action:Se,className:"flex flex-col h-full justify-between",children:[t.jsxs("div",{className:"flex flex-col gap-6",children:[t.jsx(O,{testId:"advanced-settings-switch",defaultIsToggled:N==="advanced",onToggle:te,isToggled:N==="advanced",children:n(l.SETTINGS$ADVANCED)}),N==="basic"&&t.jsxs("div",{"data-testid":"llm-settings-form-basic",className:"flex flex-col gap-6",children:[!V&&!Y&&t.jsxs(t.Fragment,{children:[t.jsx(Ae,{models:q,currentModel:s.LLM_MODEL||R,onChange:se,wrapperClassName:"!flex-col !gap-6"}),(s.LLM_MODEL?.startsWith("openhands/")||v?.startsWith("openhands/"))&&t.jsx(Z,{testId:"openhands-api-key-help"})]}),t.jsx(I,{testId:"llm-api-key-input",name:"llm-api-key-input",label:n(l.SETTINGS_FORM$API_KEY),type:"password",className:"w-full max-w-[680px]",placeholder:s.LLM_API_KEY_SET?"<hidden>":"",onChange:P,startContent:s.LLM_API_KEY_SET&&t.jsx(D,{isSet:s.LLM_API_KEY_SET})}),t.jsx(L,{testId:"llm-api-key-help-anchor",text:n(l.SETTINGS$DONT_KNOW_API_KEY),linkText:n(l.SETTINGS$CLICK_FOR_INSTRUCTIONS),href:"https://docs.all-hands.dev/usage/local-setup#getting-an-api-key"})]}),N==="advanced"&&t.jsxs("div",{"data-testid":"llm-settings-form-advanced",className:"flex flex-col gap-6",children:[t.jsx(I,{testId:"llm-custom-model-input",name:"llm-custom-model-input",label:n(l.SETTINGS$CUSTOM_MODEL),defaultValue:s.LLM_MODEL||R,placeholder:R,type:"text",className:"w-full max-w-[680px]",onChange:ae}),(s.LLM_MODEL?.startsWith("openhands/")||v?.startsWith("openhands/"))&&t.jsx(Z,{testId:"openhands-api-key-help-2"}),t.jsx(I,{testId:"base-url-input",name:"base-url-input",label:n(l.SETTINGS$BASE_URL),defaultValue:s.LLM_BASE_URL,placeholder:"https://api.openai.com",type:"text",className:"w-full max-w-[680px]",onChange:le}),t.jsx(I,{testId:"llm-api-key-input",name:"llm-api-key-input",label:n(l.SETTINGS_FORM$API_KEY),type:"password",className:"w-full max-w-[680px]",placeholder:s.LLM_API_KEY_SET?"<hidden>":"",onChange:P,startContent:s.LLM_API_KEY_SET&&t.jsx(D,{isSet:s.LLM_API_KEY_SET})}),t.jsx(L,{testId:"llm-api-key-help-anchor-advanced",text:n(l.SETTINGS$DONT_KNOW_API_KEY),linkText:n(l.SETTINGS$CLICK_FOR_INSTRUCTIONS),href:"https://docs.all-hands.dev/usage/local-setup#getting-an-api-key"}),X?.APP_MODE!=="saas"&&t.jsxs(t.Fragment,{children:[t.jsx(I,{testId:"search-api-key-input",name:"search-api-key-input",label:n(l.SETTINGS$SEARCH_API_KEY),type:"password",className:"w-full max-w-[680px]",defaultValue:s.SEARCH_API_KEY||"",onChange:ne,placeholder:n(l.API$TVLY_KEY_EXAMPLE),startContent:s.SEARCH_API_KEY_SET&&t.jsx(D,{isSet:s.SEARCH_API_KEY_SET})}),t.jsx(L,{testId:"search-api-key-help-anchor",text:n(l.SETTINGS$SEARCH_API_KEY_OPTIONAL),linkText:n(l.SETTINGS$SEARCH_API_KEY_INSTRUCTIONS),href:"https://tavily.com/"}),t.jsx(z,{testId:"agent-input",name:"agent-input",label:n(l.SETTINGS$AGENT),items:E?.agents.map(e=>({key:e,label:e}))||[],defaultSelectedKey:s.AGENT,isClearable:!1,onInputChange:ie,wrapperClassName:"w-full max-w-[680px]"})]}),t.jsxs("div",{className:"w-full max-w-[680px]",children:[t.jsx(I,{testId:"condenser-max-size-input",name:"condenser-max-size-input",type:"number",min:20,step:1,label:n(l.SETTINGS$CONDENSER_MAX_SIZE),defaultValue:(s.CONDENSER_MAX_SIZE??r.CONDENSER_MAX_SIZE)?.toString(),onChange:e=>ce(e),isDisabled:!s.ENABLE_DEFAULT_CONDENSER}),t.jsx("p",{className:"text-xs text-tertiary-alt mt-1",children:n(l.SETTINGS$CONDENSER_MAX_SIZE_TOOLTIP)})]}),t.jsx(O,{testId:"enable-memory-condenser-switch",name:"enable-memory-condenser-switch",defaultIsToggled:s.ENABLE_DEFAULT_CONDENSER,onToggle:re,children:n(l.SETTINGS$ENABLE_MEMORY_CONDENSATION)}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(O,{testId:"enable-confirmation-mode-switch",name:"enable-confirmation-mode-switch",onToggle:oe,defaultIsToggled:s.CONFIRMATION_MODE,isBeta:!0,children:n(l.SETTINGS$CONFIRMATION_MODE)}),t.jsx(fe,{tooltip:n(l.SETTINGS$CONFIRMATION_MODE_TOOLTIP),ariaLabel:n(l.SETTINGS$CONFIRMATION_MODE),className:"text-[#9099AC] hover:text-white cursor-help",children:t.jsx(Le,{width:16,height:16})})]}),Q&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"w-full max-w-[680px]",children:[t.jsx(z,{testId:"security-analyzer-input",name:"security-analyzer-display",label:n(l.SETTINGS$SECURITY_ANALYZER),items:Ee(),placeholder:n(l.SETTINGS$SECURITY_ANALYZER_PLACEHOLDER),selectedKey:g||"none",isClearable:!1,onSelectionChange:e=>{const a=e?.toString()||"";_(a),G(a)},onInputChange:e=>{e||(_(""),G(""))},wrapperClassName:"w-full"}),t.jsx("input",{type:"hidden",name:"security-analyzer-input",value:g||""})]}),t.jsx("p",{className:"text-xs text-tertiary-alt max-w-[680px]",children:n(l.SETTINGS$SECURITY_ANALYZER_DESCRIPTION)})]})]})]}),t.jsx("div",{className:"flex gap-6 p-6 justify-end",children:t.jsxs(xe,{testId:"submit-button",type:"submit",variant:"primary",isDisabled:!de||m,children:[!m&&n("SETTINGS$SAVE_CHANGES"),m&&n("SETTINGS$SAVING")]})})]})})}const ot=Ie(De);export{ot as default};
